window.__require=function e(t,o,n){function a(i,r){if(!o[i]){if(!t[i]){var s=i.split("/");if(s=s[s.length-1],!t[s]){var l="function"==typeof __require&&__require;if(!r&&l)return l(s,!0);if(c)return c(s,!0);throw new Error("Cannot find module '"+i+"'")}i=s}var d=o[i]={exports:{}};t[i][0].call(d.exports,function(e){return a(t[i][1][e]||e)},d,d.exports,e,t,o,n)}return o[i].exports}for(var c="function"==typeof __require&&__require,i=0;i<n.length;i++)a(n[i]);return a}({UIManager:[function(e,t,o){"use strict";cc._RF.push(t,"60cc1IgUrNMO6H7ujP5E9ZW","UIManager");var n=e("./tool"),a=e("./heroData"),c=e("./gameData"),i=e("./userData");cc.Class({extends:cc.Component,properties:{atkLab:cc.Label,defLab:cc.Label,hpLab:cc.Label,expLab:cc.Label,speedLab:cc.Label,goldLab:cc.Label,yellowKeyLab:cc.Label,buleKeyLab:cc.Label,redKeyLab:cc.Label,layerLab:cc.Label,levelLab:cc.Label,saveProgressBtn:cc.Node,propInfoBtn:cc.Node,musicBtn:cc.Node,exptset:cc.Node},onLoad:function(){this.addBtnListen(),this.initMusicLab()},init:function(e){this.mainClass=e,this.updateUI()},updateUI:function(){this.atkLab.string=a.atk,this.defLab.string=a.def,this.hpLab.string=a.hp,this.expLab.string=a.exp,this.speedLab.string=a.atkSpeed,this.goldLab.string=a.gold,this.yellowKeyLab.string=a.yellowKey,this.buleKeyLab.string=a.buleKey,this.redKeyLab.string=a.redKey,this.levelLab.string=a.level},initMusicLab:function(){0==c.effectMusicSize?this.musicBtn.getChildByName("Background").getChildByName("Label").getComponent(cc.Label).string="\u97f3\u4e50(\u5f00)":this.musicBtn.getChildByName("Background").getChildByName("Label").getComponent(cc.Label).string="\u97f3\u4e50(\u5173)"},addBtnListen:function(){var e=this;this.saveProgressBtn.on("click",function(){n.loadNode("prefabs/chooseProgress","chooseProgress",function(t){t.parent=e.node,t.active=!0,t.getComponent("chooseProgress").saveGameInit()})},this),this.propInfoBtn.on("click",function(){n.loadNode("prefabs/propInfo","propInfo",function(t){t.parent=e.node,t.active=!0})},this),this.musicBtn.on("click",function(){c.bgMusicSize=1==c.bgMusicSize?0:1,c.effectMusicSize=1==c.effectMusicSize?0:1,cc.sys.localStorage.setItem("bgMusic".concat(i.userId),c.bgMusicSize),cc.sys.localStorage.setItem("effectMusic".concat(i.userId),c.effectMusicSize),e.initMusicLab()},this)},updateLayer:function(){this.layerLab.string=a.curLayer},showFightUI:function(e,t,o){var a=this;n.loadNode("prefabs/fightUI","fightUI",function(n){n.parent=a.node,n.active=!0,n.getComponent("fight").startFight(e,t,o)})}}),cc._RF.pop()},{"./gameData":"gameData","./heroData":"heroData","./tool":"tool","./userData":"userData"}],chooseProgress:[function(e,t,o){"use strict";cc._RF.push(t,"6f616MVCytFsomGE9Aw+Wpe","chooseProgress");var n={pos:cc.v2(7,14),hp:1e3,atk:10,def:10,gold:0,atkSpeed:5,exp:0,yellowKey:0,buleKey:0,redKey:0,curLayer:1,level:1,heroDir:cc.v2(0,1),noteStairs:{},heroSword:0,heroShield:138,goldNpc:[{gold:20,count:0}],expNpc:[{exp:70,count:0}],keyNpc:{yellow:{gold:50,count:0},bule:{gold:100,count:0},red:{gold:200,count:0}},propArr:{121:0,142:0,151:0,153:0,171:0,122:0},meetProp:{}},a=e("../../script/tool"),c=e("../../script/gameData"),i=e("../../script/heroData");cc.Class({extends:cc.Component,properties:{},onLoad:function(){var e=this;this.node.getChildByName("back").on("click",function(){a.recycleNode(e.node)},this)},loadLocalTitle:function(){var e=this,t=a.loadLocalTitle();c.localTitle=t;for(var o=function(o){t[o]?(e.tileNodeArr[o].getChildByName("hasValue").active=!0,e.tileNodeArr[o].getChildByName("noValue").active=!1,e.tileNodeArr[o].getChildByName("hasValue").getChildByName("levelValue").getComponent(cc.Label).string=t[o].level,e.tileNodeArr[o].getChildByName("hasValue").getChildByName("timeValue").getComponent(cc.Label).string=t[o].time,e.tileNodeArr[o].getChildByName("hasValue").getChildByName("playtimeValue").getComponent(cc.Label).string=a.getPlayTime(t[o].playTime)):(e.tileNodeArr[o].getChildByName("hasValue").active=!1,e.tileNodeArr[o].getChildByName("noValue").active=!0),e.tileNodeArr[o].targetOff(e),e.tileNodeArr[o].on("click",function(){if(e.newGame){a.deleteProgress(o),a.saveProgress(o,o,[],n);var i={level:1,time:e.getdate(),playTime:0};c.localTitle[o]=i,a.saveLocalTitle(c.localTitle),c.progressIndex=o,e.mainClass.node.active=!1,a.loadNode("prefabs/bgDialog","bgDialog",function(e){e.parent=cc.director.getScene().children[0],e.active=!0,e.getComponent("dialog").init(null,[["\u65f6\u95f4\u4e0d\u77e5\u9053\u8fc7\u53bb\u4e86\u591a\u4e45\uff0c\u88ab\u82f1\u96c4\u6253\u8d25\u7684\u9b54\u738b\u5728\u9b54\u5854\u4e2d\u6e10\u6e10\u6062\u590d\u4e86\u5b9e\u529b\uff0c\u524d\u51e0\u5929\u5b83\u63a0\u8d70\u4e86\u738b\u56fd\u7684\u516c\u4e3b\uff0c\u8fd9\u6b21\u4f3c\u4e4e\u662f\u544a\u8bc9\u4eba\u4eec\u5b83\u56de\u6765\u4e86\uff0c\u5e73\u9759\u7684\u738b\u56fd\u4e00\u65f6\u95f4\u53c8\u9677\u5165\u4e86\u6050\u614c\u4e4b\u4e2d\uff0c\u56fd\u738b\u5f88\u7740\u6025\uff0c\u53d1\u51fa\u4e86\u516c\u544a\uff0c\u8c01\u80fd\u6551\u4e0b\u516c\u4e3b\u5e76\u4e14\u6253\u8d25\u9b54\u738b\u5c31\u4f1a\u5c06\u516c\u4e3b\u8bb8\u914d\u7ed9\u4ed6\uff0c100\u5e74\u524d\u7684\u6545\u4e8b\u4f3c\u4e4e\u53c8\u91cd\u6f14\u4e86\uff0c\u8fc7\u53bb\u53bb\u4e86\u9b54\u5854\u7684\u82f1\u96c4\u90fd\u6ca1\u6709\u6d88\u606f\uff0c\u800c\u4f60\u662f\u7b2c2021\u4e2a\u6765\u5230\u9b54\u5854\u7684\u52c7\u58eb\u3002"],null,null])}),a.recycleNode(e.node),cc.director.emit("DungeonedEvent",{event:"initGame"})}else t[o]&&(c.progressIndex=o,e.mainClass.node.active=!1,cc.director.emit("DungeonedEvent",{event:"initGame"}),a.recycleNode(e.node))},e)},i=0;i<this.tileNodeArr.length;i++)o(i)},getdate:function(){var e=new Date,t=e.getFullYear(),o=e.getMonth()+1,n=e.getDate();return t+"-"+(o<10?"0"+o:o)+"-"+(n<10?"0"+n:n)+" "+e.toTimeString().substr(0,8)},loadGameInit:function(e,t){this.mainClass=t,this.tileNodeArr=this.node.getChildByName("nodeP").children,this.newGame=e,this.node.getChildByName("cover").getComponent(cc.Label).string=e?"\u8986\u76d6\u54ea\u4e2a\u8fdb\u5ea6?":"\u4ece\u54ea\u4e2a\u8fdb\u5ea6\u5f00\u59cb\u6e38\u620f",this.loadLocalTitle()},saveGameInit:function(){var e=this;this.tileNodeArr=this.node.getChildByName("nodeP").children,this.node.getChildByName("cover").getComponent(cc.Label).string="\u4fdd\u5b58\u5230\u54ea\u4e2a\u8fdb\u5ea6?";var t=a.loadLocalTitle();c.localTitle=t;for(var o=function(o){t[o]?(e.tileNodeArr[o].getChildByName("hasValue").active=!0,e.tileNodeArr[o].getChildByName("noValue").active=!1,e.tileNodeArr[o].getChildByName("hasValue").getChildByName("levelValue").getComponent(cc.Label).string=t[o].level,e.tileNodeArr[o].getChildByName("hasValue").getChildByName("timeValue").getComponent(cc.Label).string=t[o].time,e.tileNodeArr[o].getChildByName("hasValue").getChildByName("playtimeValue").getComponent(cc.Label).string=a.getPlayTime(t[o].playTime)):(e.tileNodeArr[o].getChildByName("hasValue").active=!1,e.tileNodeArr[o].getChildByName("noValue").active=!0),e.tileNodeArr[o].targetOff(e),e.tileNodeArr[o].on("click",function(){c.startTime?(i.playTime=i.playTime+(Date.parse(new Date)-c.startTime),c.startTime=Date.parse(new Date)):i.playTime=0;var t={level:i.level,time:e.getdate(),playTime:i.playTime};c.localTitle[o]=t,a.saveLocalTitle(c.localTitle),a.saveProgress(c.progressIndex,o,c.layerConfig,i),c.progressIndex=o,e.tileNodeArr[o].getChildByName("hasValue").active=!0,e.tileNodeArr[o].getChildByName("noValue").active=!1,e.tileNodeArr[o].getChildByName("hasValue").getChildByName("levelValue").getComponent(cc.Label).string=t.level,e.tileNodeArr[o].getChildByName("hasValue").getChildByName("timeValue").getComponent(cc.Label).string=t.time,e.tileNodeArr[o].getChildByName("hasValue").getChildByName("playtimeValue").getComponent(cc.Label).string=a.getPlayTime(i.playTime),a.pop(null,"\u4fdd\u5b58\u6210\u529f")},e)},n=0;n<this.tileNodeArr.length;n++)o(n)}}),cc._RF.pop()},{"../../script/gameData":"gameData","../../script/heroData":"heroData","../../script/tool":"tool"}],config:[function(e,t,o){"use strict";cc._RF.push(t,"92915kKUXlPdoN6Ho9nW7am","config");var n={itemInfo:{124:{info:"\u653b\u51fb\u529b\u589e\u52a02",name:"\u7ea2\u6c34\u6676"},125:{info:"\u9632\u5fa1\u529b\u589e\u52a02",name:"\u84dd\u6c34\u6676"},134:{info:"\u751f\u547d\u503c\u589e\u52a050",name:"\u5c0f\u8840\u74f6"},135:{info:"\u751f\u547d\u503c\u589e\u52a0150",name:"\u5927\u8840\u74f6"},136:{info:"\u7ecf\u9a8c\u589e\u52a05",name:"\u7ecf\u9a8c\u836f\u6c34"},126:{info:"\u901f\u5ea6\u589e\u52a02",name:"\u901f\u5ea6\u6c34\u6676"},145:{info:"\u5f00\u542f\u84dd\u8272\u7684\u95e8",name:"\u84dd\u94a5\u5319"},144:{info:"\u5f00\u542f\u9ec4\u8272\u7684\u95e8",name:"\u9ec4\u94a5\u5319"},146:{info:"\u5f00\u542f\u7ea2\u8272\u7684\u95e8",name:"\u7ea2\u94a5\u5319"},171:{info:"\u67e5\u770b\u5f53\u524d\u697c\u5c42\u602a\u7269\u4fe1\u606f",name:"\u602a\u7269\u624b\u518c"},142:{info:"\u6316\u5f00\u4e00\u4e2a\u6709\u88c2\u7f1d\u7684\u5899",name:"\u5341\u5b57\u9550"},127:{info:"\u653b\u51fb\u529b\u589e\u52a020",name:"\u94c1\u5251"},137:{info:"\u9632\u5fa1\u529b\u589e\u52a020",name:"\u94c1\u76fe"},128:{info:"\u653b\u51fb\u529b\u589e\u52a040",name:"\u9a91\u58eb\u5251"},138:{info:"\u9632\u5fa1\u529b\u589e\u52a040",name:"\u9a91\u58eb\u76fe"},140:{info:"\u9632\u5fa1\u529b\u589e\u52a0100",name:"\u767d\u91d1\u76fe"},151:{info:"\u5bf9\u6297\u9ab7\u9ac5\u738b\u65f6\u51cf\u5f31\u9ab7\u9ac5\u738b\u653b\u51fb\u529b",name:"\u6559\u7687\u9996\u9970"},153:{info:"\u6253\u5f00\u6240\u5728\u697c\u5c42\u7684\u7262\u95e8",name:"\u4e07\u80fd\u94a5\u5319"},121:{info:"\u53ef\u4ee5\u98de\u5f80\u53bb\u8fc7\u7684\u697c\u5c42,\u53ea\u80fd\u5728\u697c\u68af\u8fb9\u4f7f\u7528",name:"\u98de\u884c\u5668"},122:{info:"\u53ef\u4ee5\u524d\u5f80\u697c\u4e0a\u7684\u9690\u85cf\u697c\u5c42",name:"\u7279\u6b8a\u98de\u884c\u5668\u98de\u884c\u5668(\u4e0a)"},131:{info:"\u7b49\u7ea7\u52a01",name:"\u98de\u5347\u5668(\u5c0f)"},143:{info:"\u653b\u51fb\u529b\u52a0\u4e0a\u9632\u5fa1\u529b\u8f6c\u5316\u6210\u7b49\u989d\u7684\u751f\u547d\u503c",name:"\u9b54\u6cd5\u6c34\u6676\u74f6"}},unAiMoveArr:["201","202","156","161","167","250","1000","203","160"],npcArr:["201","202","250","203"],needStopAiMoveArr:["164","163","169"],advanceStopMove:["157","158","159"],layer1HideItemArr:[cc.v2(1,11),cc.v2(2,11),cc.v2(1,12),cc.v2(2,12),cc.v2(1,13),cc.v2(2,13),cc.v2(3,13),cc.v2(12,11),cc.v2(13,11),cc.v2(13,12),cc.v2(12,12),cc.v2(12,13),cc.v2(13,13),cc.v2(11,13)],layer1DelItemArr:[cc.v2(1,11),cc.v2(2,11),cc.v2(1,12),cc.v2(2,12),cc.v2(1,13),cc.v2(2,13),cc.v2(3,13),cc.v2(12,11),cc.v2(13,11),cc.v2(12,12),cc.v2(13,12),cc.v2(12,13),cc.v2(13,13),cc.v2(11,13),cc.v2(4,13),cc.v2(5,13),cc.v2(9,13),cc.v2(10,13)],layer16CloseDoorPos:[cc.v2(9,9),cc.v2(10,9),cc.v2(12,9),cc.v2(9,10),cc.v2(10,10),cc.v2(11,10),cc.v2(12,10),cc.v2(9,11),cc.v2(10,11),cc.v2(11,11),cc.v2(12,11),cc.v2(9,12)],layer16OpenDoorPos:[cc.v2(11,9),cc.v2(10,12),cc.v2(11,12),cc.v2(12,12)],SingleUse:{1:{atk:2},2:{def:2},3:{hp:100},4:{hp:300},13:{exp:10}},EnemyAttribute:{503:{hp:45,atk:26,def:4,atkSpeed:6,gold:2,ex:1,name:"\u5c0f\u8759\u8760",id:"503"},504:{hp:25,atk:18,def:1,atkSpeed:5,gold:1,ex:1,name:"\u7eff\u53f2\u83b1\u59c6",id:"504"},505:{hp:30,atk:20,def:2,atkSpeed:5,gold:2,ex:1,name:"\u7ea2\u53f2\u83b1\u59c6",id:"505"},501:{hp:80,atk:70,def:8,atkSpeed:6,gold:5,ex:1,name:"\u9ab7\u9ac5\u4eba",id:"501"},502:{hp:150,atk:115,def:30,atkSpeed:6,gold:6,ex:3,name:"\u9ab7\u9ac5\u9a91\u58eb",id:"502"},506:{hp:40,atk:60,def:5,atkSpeed:7,gold:6,ex:2,name:"\u521d\u7ea7\u6cd5\u5e08",id:"506"},80:{hp:110,atk:90,def:35,atkSpeed:8,gold:6,ex:2,name:"\u521d\u7ea7\u58eb\u5175",id:"80"},8:{hp:350,atk:180,def:35,atkSpeed:8,gold:18,ex:4,name:"\u5f02\u53d8\u9ab7\u9ac5\u5175",id:"8"},12:{hp:1e3,atk:440,def:40,atkSpeed:9,gold:30,ex:8,name:"\u9ab7\u9ac5\u738b",id:"12"},20:{hp:380,atk:150,def:45,atkSpeed:12,gold:12,ex:3,name:"\u5927\u5438\u8840\u8759\u8760",id:"20"},40:{hp:400,atk:140,def:55,atkSpeed:10,gold:16,ex:3,name:"\u5927\u53f2\u83b1\u59c6",id:"40"},52:{hp:300,atk:260,def:45,atkSpeed:14,gold:14,ex:4,name:"\u4e2d\u7ea7\u6cd5\u5e08",id:"52"},56:{hp:2e3,atk:680,def:155,atkSpeed:18,gold:45,ex:8,name:"\u9ebb\u8863\u6cd5\u738b",id:"56"},64:{hp:400,atk:225,def:50,atkSpeed:12,gold:20,ex:4,name:"\u517d\u4eba",id:"64"},68:{hp:700,atk:290,def:75,atkSpeed:13,gold:25,ex:6,name:"\u517d\u4eba\u9a91\u58eb",id:"68"},72:{hp:10,atk:20,def:200,atkSpeed:8,gold:28,ex:6,name:"\u77f3\u5934\u4eba",id:"72"},84:{hp:900,atk:350,def:85,atkSpeed:16,gold:30,ex:6,name:"\u4e2d\u7ea7\u58eb\u5175",id:"84"},192:{hp:850,atk:420,def:95,atkSpeed:18,gold:35,ex:7,name:"\u9ad8\u7ea7\u6cd5\u5e08",id:"192"},521:{hp:5500,atk:320,atkSpeed:28,def:220,gold:150,ex:30,name:"\u7ea2\u9f99",id:"521"}}};t.exports=n,cc._RF.pop()},{}],control:[function(e,t,o){"use strict";function n(e){return i(e)||c(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function i(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}cc._RF.push(t,"31992BM9yVIeIpzqUNzM5l4","control");var r=e("./heroData"),s=e("./gameData"),l=e("./config"),d=e("./tool");cc.Class({extends:cc.Component,properties:{touchNodeList:[cc.Node],layerNode:cc.Node},onLoad:function(){this.isMove=!1,s.gameStatu=0},init:function(e){var t=this;this.mainClass=e,this.heroClass=e.heroClass,this.layerManagerClass=e.layerManagerClass,this.addBtnControl(),this.layerNode.on("touchend",function(e){if(t.unscheduleAllCallbacks(),1!=s.gameStatu){var o=t.layerManagerClass.floorLayer.node.convertToNodeSpaceAR(e.getLocation()),n=parseInt(o.x/32),a=t.layerManagerClass.layerSize.width-parseInt(o.y/32)-1,c=t.checkIsNear(n,a);c&&t.heroClass.changeDir(cc.v2(n-r.pos.x,r.pos.y-a)),0!=t.layerManagerClass.wallLayer.getTiledTileAt(n,a,!0).gid&&(t.heroClass.stopAllAnim(),d.playEffect("error"));var i=d.aiMove(r.pos,cc.v2(n,a),t.layerManagerClass.wallArr,t.getUnableMoveArr(),s.curLayerEnemyPosArr,s.curLayerDoorPosArr,s.curLayerStairsPosArr);i<=0&&(i=d.aiMove(r.pos,cc.v2(n,a),t.layerManagerClass.wallArr,t.getUnableMoveArr(),[],s.curLayerDoorPosArr,s.curLayerStairsPosArr))<=0&&(i=d.aiMove(r.pos,cc.v2(n,a),t.layerManagerClass.wallArr,t.getUnableMoveArr(),s.curLayerEnemyPosArr,[],s.curLayerStairsPosArr))<=0&&(i=d.aiMove(r.pos,cc.v2(n,a),t.layerManagerClass.wallArr,t.getUnableMoveArr(),[],[],s.curLayerStairsPosArr))<=0&&(i=d.aiMove(r.pos,cc.v2(n,a),t.layerManagerClass.wallArr,t.getUnableMoveArr(),[],[],[])),i.length<=0?c&&(t.heroClass.stopAllAnim(),t.layerManagerClass.triggerGrid(n,a)):(t.unscheduleAllCallbacks(),t.moveHeroUseArr(i))}},this)},initHeroPos:function(){this.moveHero(r.pos)},checkTouchItem:function(e,t){for(var o=!0,n=0;n<s.layerConfig[r.curLayer].length;n++)if(s.layerConfig[r.curLayer][n].x==e&&s.layerConfig[r.curLayer][n].y==t&&"hideItem"!=s.layerConfig[r.curLayer][n].type&&l.unAiMoveArr.includes(s.layerConfig[r.curLayer][n].id)){o=!1;break}return o},getUnableMoveArr:function(){var e=[];return s.layerConfig[r.curLayer].map(function(t){l.unAiMoveArr.includes(t.id)&&"hideItem"!=t.type&&e.push(t.x+"-"+t.y)}),e=e.concat(s.unMovePosArr)},checkIsNear:function(e,t){var o=[r.pos.x,r.pos.y],n=o[0],a=o[1];return!![n+1+"-"+a,n-1+"-"+a,n+"-"+(a+1),n+"-"+(a-1)].includes(e+"-"+t)},moveHeroUseArr:function(e){var t,o=e.length-2;if(o>=0){var a=n(this.checkGrid(e[o].x,e[o].y)),c=a[0],i=a[1];if(this.heroClass.changeDir(cc.v2(e[o].x-r.pos.x,r.pos.y-e[o].y)),c)return s.gameStatu=1,this.mainClass.fightWithEnemy([c.enemtId,cc.v2(e[o].x,e[o].y)]),this.heroClass.stopAllAnim(),void this.unscheduleAllCallbacks();if(i&&(t=i.id),t&&l.advanceStopMove.includes(t))return this.layerManagerClass.triggerGrid(e[o].x,e[o].y),void this.heroClass.stopAllAnim();if(this.moveHero(cc.v2(e[o].x,e[o].y)),this.layerManagerClass.triggerGrid(e[o].x,e[o].y),t&&l.needStopAiMoveArr.includes(t))return this.unscheduleAllCallbacks(),void this.heroClass.stopAllAnim();o--}this.moveCallback=this.schedule(function(){if(o>=0){var a=n(this.checkGrid(e[o].x,e[o].y)),c=a[0],i=a[1];return this.heroClass.changeDir(cc.v2(e[o].x-r.pos.x,r.pos.y-e[o].y)),c?(s.gameStatu=1,this.mainClass.fightWithEnemy([c.enemtId,cc.v2(e[o].x,e[o].y)]),this.unscheduleAllCallbacks(),void this.heroClass.stopAllAnim()):(i&&(t=i.id),t&&l.advanceStopMove.includes(t)?(this.layerManagerClass.triggerGrid(e[o].x,e[o].y),void this.heroClass.stopAllAnim()):(this.moveHero(cc.v2(e[o].x,e[o].y)),this.layerManagerClass.triggerGrid(e[o].x,e[o].y),t&&l.needStopAiMoveArr.includes(t)?(this.heroClass.stopAllAnim(),void this.unscheduleAllCallbacks()):void o--))}this.heroClass.stopAllAnim(),this.unscheduleAllCallbacks()},s.moveSpeed)},removeScheule:function(){this.unschedule(this.moveCallback)},addBtnControl:function(){for(var e=this,t=function(t){e.touchNodeList[t].on("touchstart",function(){console.log(s.gameStatu),e.unscheduleAllCallbacks(),0==t?(e.heroClass.startLeft(),e.moveFunc(-1,null),e.moveCallback=e.schedule(function(){this.moveFunc(-1,null)},s.moveSpeed)):1==t?(e.heroClass.startRight(),e.moveFunc(1,null),e.moveCallback=e.schedule(function(){this.moveFunc(1,null)},s.moveSpeed)):2==t?(e.heroClass.startUp(),e.moveFunc(null,-1),e.moveCallback=e.schedule(function(){this.moveFunc(null,-1)},s.moveSpeed)):(e.heroClass.startDown(),e.moveFunc(null,1),e.moveCallback=e.schedule(function(){this.moveFunc(null,1)},s.moveSpeed))},e),e.touchNodeList[t].on("touchend",function(){e.unscheduleAllCallbacks(),e.heroClass.stopAllAnim()},e),e.touchNodeList[t].on("touchcancel",function(){e.unscheduleAllCallbacks(),e.heroClass.stopAllAnim()},e)},o=0;o<this.touchNodeList.length;o++)t(o)},checkRunWall:function(e,t){return!!s.unMovePosArr.includes(e+"-"+t)||0!=this.layerManagerClass.wallLayer.getTiledTileAt(e,t,!0).gid},moveFunc:function(e,t){if(1!=s.gameStatu){var o,a=r.pos;console.log("gamestatu",s.gameStatu);if(null!=e){var c=n(this.checkGrid(a.x+e,a.y)),i=c[0],p=c[1];if(this.heroClass.changeDir(cc.v2(a.x+e-r.pos.x,r.pos.y-a.y)),i)return s.gameStatu=1,void this.mainClass.fightWithEnemy([i.enemtId,cc.v2(a.x+e,a.y)]);if(p&&(o=p.id),o&&l.advanceStopMove.includes(o)||!this.checkTouchItem(a.x+e,a.y))return this.unscheduleAllCallbacks(),void this.layerManagerClass.triggerGrid(a.x+e,a.y);this.checkRunWall(a.x+e,a.y)?d.playEffect("error"):(this.layerManagerClass.triggerGrid(a.x+e,a.y),a.x+=e,this.moveHero(a))}else if(null!=t){var u=n(this.checkGrid(a.x,a.y+t)),h=u[0],y=u[1];if(this.heroClass.changeDir(cc.v2(a.x-r.pos.x,r.pos.y-(a.y+t))),h)return s.gameStatu=1,void this.mainClass.fightWithEnemy([h.enemtId,cc.v2(a.x,a.y+t)]);if(y&&(o=y.id),o&&l.advanceStopMove.includes(o)||!this.checkTouchItem(a.x,a.y+t))return this.unscheduleAllCallbacks(),void this.layerManagerClass.triggerGrid(a.x,a.y+t);this.checkRunWall(a.x,a.y+t)?d.playEffect("error"):(this.layerManagerClass.triggerGrid(a.x,a.y+t),a.y+=t,this.moveHero(a))}}},moveHero:function(e){var t=this.layerManagerClass.floorLayer.getTiledTileAt(e.x,e.y,!0);this.heroClass.hero.position=cc.v2(t.node.position.x+=this.layerManagerClass.tiledSize.width/2,t.node.position.y+=this.layerManagerClass.tiledSize.height/2),r.pos=e},checkGrid:function(e,t){var o=s.layerNodeMap["".concat(e,"-").concat(t)],n=null,a=null;return o&&(n=o.getComponent("enemy"),a=o.getComponent("item")),[n,a]}}),cc._RF.pop()},{"./config":"config","./gameData":"gameData","./heroData":"heroData","./tool":"tool"}],dialog:[function(e,t,o){"use strict";function n(e){return i(e)||c(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function i(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}cc._RF.push(t,"de9ceFLQw5A8oZ1PRTKYacQ","dialog");var r=e("tool");cc.Class({extends:cc.Component,properties:{text:cc.Label},onLoad:function(){var e=this;this.node.on("click",function(){e.inPlay||(e.curIndex<e.maxCount?(r.playEffect("xuanze"),e.curIndex++,e.showText(e.curIndex)):(e.node.active=!1,r.recycleNode(e.node),e.mainClass&&e.mainClass.closeDialog(e.pos,e.id)))},this)},init:function(e,t){this.curIndex=0;var o=n(t);this.dialogArr=o[0],this.pos=o[1],this.id=o[2],this.maxCount=this.dialogArr.length-1,r.playEffect("xuanze"),this.showText(this.curIndex),this.mainClass=e},showText:function(e){var t=this;this.inPlay=!0;var o=n(this.dialogArr[e]),a=o[0];this.text.string=a;for(var c=function(e){setTimeout(function(){a+=o[e],t.text.string=a,e==o.length-1&&(t.inPlay=!1)},20*e)},i=1;i<o.length;i++)c(i)}}),cc._RF.pop()},{tool:"tool"}],enemyInfoItem:[function(e,t,o){"use strict";cc._RF.push(t,"e8bf8BENTlBGZmQ75bJeHON","enemyInfoItem");var n=e("tool"),a=e("heroData");cc.Class({extends:cc.Component,properties:{enemyP:cc.Node,infoLabel:cc.Label,atkValue:cc.Label,defValue:cc.Label,hpValue:cc.Label,goldValue:cc.Label,expValue:cc.Label,speedValue:cc.Label,nameLabel:cc.Label},init:function(e){var t=this;n.loadPoolNode("enemyItem/enemy".concat(e.id),"enemy"+e.id,function(o){t.enemyNode=o,o.active=!0,o.position=cc.v2(0,0),o.parent=t.enemyP,"521"==e.id?(t.enemyP.scaleX=.6,t.enemyP.scaleY=.6):(t.enemyP.scaleX=2,t.enemyP.scaleY=2)}),this.nameLabel.string=e.name,this.infoLabel.string=this.getTip(e,a),this.atkValue.string=e.atk,this.defValue.string=e.def,this.hpValue.string=e.hp,this.goldValue.string=e.gold,this.expValue.string=e.ex,this.speedValue.string=e.atkSpeed},getTip:function(e,t){if(e.def>=t.atk)return"\u65e0\u6cd5\u653b\u51fb";this.enemyAtk=e.atk,12==e.id&&t.propArr[151]&&(this.enemyAtk=e.atk/2);for(var o=e.hp,n=0,a=0,c=e.atkSpeed+t.atkSpeed,i=0;o>0;)a>=c?(i+=this.enemyAtk-t.def,a=0):n>=c?(o-=t.atk-e.def,n=0):(n+=t.atkSpeed,a+=e.atkSpeed);return i<=0?"\u65e0\u6d88\u8017":"\u9884\u8ba1\u635f\u5931".concat(i,"\u70b9\u751f\u547d\u503c")},onDisable:function(){this.enemyNode.active=!1,n.recyclePoolNode(this.enemyNode)},onDestory:function(){this.enemyNode.active=!1,n.recyclePoolNode(this.enemyNode)}}),cc._RF.pop()},{heroData:"heroData",tool:"tool"}],enemyInfo:[function(e,t,o){"use strict";cc._RF.push(t,"e1eacHcb1hF6KUta8DI3Gd3","enemyInfo");var n=e("gameData"),a=e("tool"),c=e("config");cc.Class({extends:cc.Component,properties:{itemPrefab:cc.Prefab,itemP:cc.Node,closeBtn:cc.Node},onLoad:function(){var e=this;this.itemPool=new cc.NodePool;for(var t=0;t<5;++t){var o=cc.instantiate(this.itemPrefab);this.itemPool.put(o)}this.closeBtn.on("click",function(){for(var t=e.itemP.children.length,o=0;o<t;o++)e.onItemKilled(e.itemP.children[0]);e.node.active=!1,a.recycleNode(e.node)},this)},createItem:function(){var e=null;return(e=this.itemPool.size()>0?this.itemPool.get():cc.instantiate(this.itemPrefab)).active=!0,e},onItemKilled:function(e){e.scaleX=1,e.scaleY=1,e.active=!1,this.itemPool.put(e)},onEnable:function(){for(var e in n.curLayerEnemy)if(n.curLayerEnemy[e]>0){var t=this.createItem();t.parent=this.itemP,t.getComponent("enemyInfoItem").init(c.EnemyAttribute[e])}}}),cc._RF.pop()},{config:"config",gameData:"gameData",tool:"tool"}],enemyManager:[function(e,t,o){"use strict";cc._RF.push(t,"ba28fzlKZBBeIRaVHq9Irbt","enemyManager");var n=e("./tool"),a=e("./heroData"),c=e("./gameData");cc.Class({extends:cc.Component,properties:{},init:function(e){this.mainClass=e;var t=this;this.funcMap={"2-521":function(){t.enemy2521()},"5-13-5":function(){t.enemy5_13_5()},"5-11-5":function(){t.enemy5_11_5()},"9-1-9":function(){t.enemy9_1_9()},"9-3-9":function(){t.enemy9_3_9()},"10-6-7":function(){t.enemy10_6_7()},"10-8-7":function(){t.enemy10_8_7()},"10-7-3":function(e,o){t.enemy10_7_3(e,o)},"18-11-4":function(){t.enemy18_11_4()},"18-13-4":function(){t.enemy18_13_4()},"20-6-8":function(){t.enemy20_6_8()},"20-8-8":function(){t.enemy20_8_8()},"20-7-3":function(e,o){t.enemy20_7_3(e,o)}},this.enemyEndFuncMap={"10-7-3":function(){t.enemyEnd10_7_3()},"20-7-3":function(){t.enemyEnd20_7_3()}}},enemyFunc:function(e,t){var o=a.curLayer+"-"+e;this.funcMap[o]?this.funcMap[o](t,e):(o="".concat(a.curLayer,"-").concat(t.x,"-").concat(t.y),this.funcMap[o]&&this.funcMap[o](t,e))},closeDialog:function(e,t){console.log(e);var o="".concat(a.curLayer,"-").concat(e.x,"-").concat(e.y),c=n.changeNpcConfig(a.curLayer,e,t);this.enemyEndFuncMap[o]&&this.enemyEndFuncMap[o](c)},enemyEnd20_7_3:function(){console.log("\u540e\u7eed"),n.delConfigShowItem(a.curLayer,cc.v2(7,7)),this.mainClass.hideNode(cc.v2(7,7));for(var e=cc.v2(7,1),t=0;t<c.layerConfig[a.curLayer].length;t++)e.x!=c.layerConfig[a.curLayer][t].x||e.y!=c.layerConfig[a.curLayer][t].y||(c.layerConfig[a.curLayer][t].type="item",this.mainClass.layerManagerClass.initNodeOrEnemy(c.layerConfig[a.curLayer][t]))},enemy20_6_8:function(){if(!n.checkPosIsHasEnemy(a.curLayer,cc.v2(8,8),192)){var e=cc.v2(7,7);cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"156"})}},enemy20_8_8:function(){if(!n.checkPosIsHasEnemy(a.curLayer,cc.v2(6,8),192)){var e=cc.v2(7,7);cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"156"})}},enemy18_11_4:function(){if(!n.checkPosIsHasEnemy(a.curLayer,cc.v2(13,4),84)){var e=cc.v2(12,3);cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"156"})}},enemy18_13_4:function(){if(!n.checkPosIsHasEnemy(a.curLayer,cc.v2(11,4),84)){var e=cc.v2(12,3);cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"156"})}},enemy10_6_7:function(){if(!n.checkPosIsHasEnemy(a.curLayer,cc.v2(8,7),8)){var e=cc.v2(7,6);cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"156"})}},enemy10_8_7:function(){if(!n.checkPosIsHasEnemy(a.curLayer,cc.v2(6,7),8)){var e=cc.v2(7,6);cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"156"})}},enemy2521:function(){var e=cc.v2(7,9);n.delConfigItem(a.curLayer,e,"521"),this.mainClass.hideNode(e)},enemyEnd10_7_3:function(){console.log("\u540e\u7eed");for(var e=[cc.v2(10,3),cc.v2(10,5),cc.v2(4,5),cc.v2(4,3),cc.v2(7,6)],t=0;t<e.length;t++)n.delConfigShowItem(a.curLayer,e[t]),this.mainClass.hideNode(e[t]);for(var o=cc.v2(7,1),i=0;i<c.layerConfig[a.curLayer].length;i++)o.x!=c.layerConfig[a.curLayer][i].x||o.y!=c.layerConfig[a.curLayer][i].y||(c.layerConfig[a.curLayer][i].type="item",this.mainClass.layerManagerClass.initNodeOrEnemy(c.layerConfig[a.curLayer][i]))},enemy20_7_3:function(e,t){var o=this,i=null;c.layerNpcBox[a.curLayer]&&c.layerNpcBox[a.curLayer]["".concat(e.x,"-").concat(e.y)]&&(i=c.layerNpcBox[a.curLayer]["".concat(e.x,"-").concat(e.y)][1]),n.loadNode("prefabs/dialog","dialog",function(n){n.parent=o.node,n.active=!0,n.getComponent("dialog").init(o,[i,e,t])})},enemy10_7_3:function(e,t){var o=this,i=null;c.layerNpcBox[a.curLayer]&&c.layerNpcBox[a.curLayer]["".concat(e.x,"-").concat(e.y)]&&(i=c.layerNpcBox[a.curLayer]["".concat(e.x,"-").concat(e.y)][1]),n.loadNode("prefabs/dialog","dialog",function(n){n.parent=o.node,n.active=!0,n.getComponent("dialog").init(o,[i,e,t])})},enemy5_13_5:function(){if(!n.checkPosIsHasEnemy(a.curLayer,cc.v2(11,5),80)){var e=cc.v2(12,4);cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"156"})}},enemy5_11_5:function(){if(!n.checkPosIsHasEnemy(a.curLayer,cc.v2(13,5),80)){var e=cc.v2(12,4);cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"156"})}},enemy9_1_9:function(){if(!n.checkPosIsHasEnemy(a.curLayer,cc.v2(3,9),80)){var e=cc.v2(2,10);cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"156"})}},enemy9_3_9:function(){if(!n.checkPosIsHasEnemy(a.curLayer,cc.v2(1,9),80)){var e=cc.v2(2,10);cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"156"})}}}),cc._RF.pop()},{"./gameData":"gameData","./heroData":"heroData","./tool":"tool"}],enemy:[function(e,t,o){"use strict";cc._RF.push(t,"3a0f7aippRD7rg/x2oQJhxJ","enemy"),cc.Class({extends:cc.Component,properties:{},init:function(e){this.enemtId=e}}),cc._RF.pop()},{}],expNpc:[function(e,t,o){"use strict";cc._RF.push(t,"fe2edjsqUhOFpp2Wt7j0+ez","expNpc");var n=e("heroData"),a=e("tool");cc.Class({extends:cc.Component,properties:{needExpLab:cc.Label,promoteAtkBtn:cc.Node,promoteDefBtn:cc.Node,promoteLevelBtn:cc.Node,closeBtn:cc.Node},onLoad:function(){var e=this;this.promoteAtkBtn.on("click",function(){n.exp>=n.expNpc[0].exp?(n.atk+=5,e.changeExp()):a.pop(null,"\u7ecf\u9a8c\u4e0d\u8db3")},this),this.promoteDefBtn.on("click",function(){n.exp>=n.expNpc[0].exp?(n.def+=5,e.changeExp()):a.pop(null,"\u7ecf\u9a8c\u4e0d\u8db3")},this),this.promoteLevelBtn.on("click",function(){n.exp>=n.expNpc[0].exp?(n.def+=3,n.atk+=3,n.hp+=200,n.level+=1,a.playEffect("shenji"),e.changeExp()):a.pop(null,"\u7ecf\u9a8c\u4e0d\u8db3")},this),this.closeBtn.on("click",function(){a.recycleNode(e.node)},this)},changeExp:function(){n.exp-=n.expNpc[0].exp,n.expNpc[0].count++,cc.director.emit("DungeonedEvent",{event:"updateUI"})},onEnable:function(){this.needExpLab.string=n.expNpc[0].exp}}),cc._RF.pop()},{heroData:"heroData",tool:"tool"}],fight:[function(e,t,o){"use strict";cc._RF.push(t,"e705ehgDhxEMpc3MkCOvLNu","fight");var n=e("tool"),a=e("gameData"),c=e("heroData");cc.Class({extends:cc.Component,properties:{enemyP:cc.Node,enemyEffect:cc.Node,enemyNameLab:cc.Label,enemyHpLab:cc.Label,enemyAtkLab:cc.Label,enemyDefLab:cc.Label,heroNode:cc.Node,heroEffect:cc.Node,heroHpLab:cc.Label,heroAtkLab:cc.Label,heroDefLab:cc.Label,slider:cc.Node,heroSlider:cc.Node,enemySliderP:cc.Node},onLoad:function(){this.intervalDis=46,this.heroPos=this.heroNode.position,this.EnemyPPos=this.enemyP.position,this.sliderMaxX=this.slider.width},init:function(){this.heroSlider.x=0,this.enemySliderP.x=0},startFight:function(e,t,o){var i=this;console.log(e,t,o,this.isFight),this.init(),n.loadPoolNode("enemyItem/enemy".concat(e.id),e.id,function(t){t.active=!0,t.position=cc.v2(0,0),t.parent=i.enemyP,i.enemyNode=t,"521"==e.id&&(t.scaleX=t.scaleX/3,t.scaleY=t.scaleY/3)}),n.loadPoolNode("enemyItem/enemy".concat(e.id),e.id,function(t){t.active=!0,t.position=cc.v2(0,0),t.parent=i.enemySliderP,i.sliderEnemy=t,"521"==e.id&&(t.scaleX=t.scaleX/3,t.scaleY=t.scaleY/3)}),this.enemyHp=e.hp,this.enemyAtk=e.atk,this.enemyDef=e.def,this.enemySpeed=e.atkSpeed,this.enemyCurSum=0,this.heroHp=o.hp,this.heroAtk=o.atk,this.heroDef=o.def,this.heroSpeed=o.atkSpeed,this.heroCurSum=0,12==e.id&&c.propArr[151]&&(this.enemyAtk=this.enemyAtk/2),this.enemyId=e.id,this.enemyNameLab.string=e.name,this.enemyHpLab.string=e.hp,this.enemyAtkLab.string=e.atk,this.enemyDefLab.string=e.def,this.heroHpLab.string=o.hp,this.heroAtkLab.string=o.atk,this.heroDefLab.string=o.def,this.speedSum=this.enemySpeed+this.heroSpeed,this.isPlayEffect=!1,this.schedule(function(){var o=this;if(!this.isPlayEffect)if(this.enemyHp>0&&this.heroHp>0){if(this.enemyCurSum>=this.speedSum)return this.isPlayEffect=!0,void this.enemyAttackHero();if(this.heroCurSum>=this.speedSum)return this.isPlayEffect=!0,void this.heroAttackEnemy();this.heroCurSum+=this.heroSpeed,this.updateHeroSlider(),this.enemyCurSum+=this.enemySpeed,this.updateEnemySlider()}else this.unscheduleAllCallbacks(),this.heroHp<=0?(setTimeout(function(){o.closeNode(),cc.director.emit("battle",{battleData:{lose:!0}})},2500),a.isOverGame=!0,n.pop(null,"\u6e38\u620f\u7ed3\u675f")):(this.closeNode(),cc.director.emit("battle",{battleData:{heroData:{hp:this.heroHp},enemyData:{enemy:e,enemyPos:t}}}))},.001)},enemyAttackHero:function(){var e=this;cc.tween(this.enemyP).to(a.atkSpeed,{position:cc.v2(this.heroPos.x-this.intervalDis,this.heroPos.y)}).call(function(){e.heroEffect.active=!0,e.switchMusicEffect(e.enemyId)}).to(a.atkSpeed,{position:this.EnemyPPos}).call(function(){e.heroDef>=e.enemyAtk?e.heroHp=e.heroHp:(e.heroHp=e.heroHp-(e.enemyAtk-e.heroDef),e.heroHp=e.heroHp<0?0:e.heroHp),e.enemyCurSum=0,e.heroHpLab.string=e.heroHp,e.heroEffect.active=!1,e.updateHeroSlider(),e.updateEnemySlider()}).start()},heroAttackEnemy:function(){var e=this;cc.tween(this.heroNode).to(a.atkSpeed,{position:cc.v2(this.EnemyPPos.x+this.intervalDis,this.EnemyPPos.y)}).call(function(){e.enemyEffect.active=!0,e.switchMusicEffect(1e3)}).to(a.atkSpeed,{position:this.heroPos}).call(function(){e.enemyDef>=e.heroAtk?e.enemyHp=e.enemyHp:(e.enemyHp=e.enemyHp-(e.heroAtk-e.enemyDef),e.enemyHp=e.enemyHp<0?0:e.enemyHp),e.heroCurSum=0,e.enemyHpLab.string=e.enemyHp,e.enemyEffect.active=!1,e.updateHeroSlider(),e.updateEnemySlider()}).start()},updateHeroSlider:function(){var e=this;this.isPlayEffect=!0;var t=this.sliderMaxX*(this.heroCurSum/this.speedSum);t=t>this.sliderMaxX?this.sliderMaxX:t,cc.tween(this.heroSlider).to(a.sliderSpeed,{position:cc.v2(t,this.heroSlider.y)},{easing:"sineOutIn"}).call(function(){e.isPlayEffect=!1}).start()},updateEnemySlider:function(){var e=this;this.isPlayEffect=!0;var t=this.sliderMaxX*(this.enemyCurSum/this.speedSum);t=t>this.sliderMaxX?this.sliderMaxX:t,cc.tween(this.enemySliderP).to(a.sliderSpeed,{position:cc.v2(t,this.enemySliderP.y)},{easing:"sineOutIn"}).call(function(){e.isPlayEffect=!1}).start()},closeNode:function(){n.recycleNode(this.node),n.recycleNode(this.enemyNode),n.recycleNode(this.sliderEnemy)},switchMusicEffect:function(e){switch(e){case 1e3:n.playEffect("jianji");break;case 506:n.playEffect("shuiji");break;case 52:n.playEffect("bingji");break;case 192:n.playEffect("huoji");break;case 56:n.playEffect("dianji");break;case 502:case 68:n.playEffect("jianji");break;case 503:case 20:n.playEffect("bainfu");break;default:n.playEffect("kongshou")}},onDisable:function(){this.unscheduleAllCallbacks()}}),cc._RF.pop()},{gameData:"gameData",heroData:"heroData",tool:"tool"}],flyProp:[function(e,t,o){"use strict";cc._RF.push(t,"e2c95E/uz5KVrm5fegMoGFL","flyProp");var n=e("heroData"),a=e("tool");cc.Class({extends:cc.Component,properties:{itemP:cc.Node,closeBtn:cc.Node},onLoad:function(){var e=this;this.closeBtn.on("click",function(){for(var t=e.itemP.children.length,o=0;o<t;o++)a.recyclePoolNode(e.itemP.children[0]);a.recycleNode(e.node)},this)},onEnable:function(){var e=Object.keys(n.noteStairs);e.sort(function(e,t){return e-t});for(var t=0;t<e.length;t++)this.initItem(e[t])},initItem:function(e){var t=this;a.loadPoolNode("prefabs/flyItem","flyItem",function(o){o.zIndex=e,o.parent=t.itemP,o.active=!0,o.getChildByName("label").getComponent(cc.Label).string=e,e==n.curLayer?o.getChildByName("bg").color=new cc.Color(194,238,186,255):o.getChildByName("bg").color=new cc.Color(255,255,255,255),o.targetOff(t),o.on("click",function(){for(var o=t.itemP.children.length,c=0;c<o;c++)a.recyclePoolNode(t.itemP.children[0]);return e==n.curLayer?(a.recycleNode(t.node),void a.playEffect("error")):a.checkNextStairs(n.noteStairs[n.curLayer][163])||a.checkNextStairs(n.noteStairs[n.curLayer][164])?(+e>+n.curLayer?n.pos=cc.v2(n.noteStairs[e][163]):+e<+n.curLayer&&(n.pos=cc.v2(n.noteStairs[e][164])),n.curLayer=e,cc.director.emit("DungeonedEvent",{event:"updateLayer"}),void a.recycleNode(t.node)):(a.pop(null,"\u4e0d\u5728\u697c\u68af\u65c1\u8fb9"),void a.playEffect("error"))},t)})}}),cc._RF.pop()},{heroData:"heroData",tool:"tool"}],gameData:[function(e,t,o){"use strict";cc._RF.push(t,"2a406EkeuVIQ4ndLNc68syL","gameData");t.exports={gameStatu:1,layerConfig:{},layerNpcBox:{},layerNodeMap:{},gameAtlas:null,curLayerLinkEnemy:[],layerPool:{},nodePoolMap:{},nodeMap:{},progressIndex:0,localTitle:[],curLayerEnemy:{},curLayerEnemyPosArr:[],curLayerDoorPosArr:[],curLayerStairsPosArr:[],unMovePosArr:[],musicMap:{},bgMusicSize:1,effectMusicSize:1,atkSpeed:1e-4,moveSpeed:.1,sliderSpeed:.2,startTime:0},cc._RF.pop()},{}],gameManager:[function(e,t,o){"use strict";function n(e){return i(e)||c(e)||a()}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function i(e){if(Array.isArray(e)){for(var t=0,o=new Array(e.length);t<e.length;t++)o[t]=e[t];return o}}cc._RF.push(t,"1fd1c6WQTdMGJSkKF6UaL9p","gameManager");var r=e("./heroData"),s=e("./gameData"),l=e("./tool"),d=e("./config"),p=e("./userData");cc.Class({extends:cc.Component,properties:{layerManagerNode:cc.Node,UIManager:cc.Node,NpcManager:cc.Node,heroNode:cc.Node,controlNode:cc.Node,propPNode:cc.Node,itemP:cc.Node,loadShade:cc.Node,gameAtlas:cc.SpriteAtlas,loadNode:cc.Node},onLoad:function(){var e=this;s.gameAtlas=this.gameAtlas,this.layerManagerClass=this.layerManagerNode.getComponent("layerManager"),this.heroClass=this.heroNode.getComponent("hero"),this.controlClass=this.controlNode.getComponent("control"),this.layerManagerClass.init(this),this.loadMusic(),this.heroClass.init(this),this.controlClass.init(this),this.UIManagerClass=this.UIManager.getComponent("UIManager"),this.npcManagerClass=this.NpcManager.getComponent("npcManager"),this.npcManagerClass.init(this),this.hideNodeManagerClass=this.node.addComponent("hideNodeManager"),this.hideNodeManagerClass.init(this),this.enemyManagerClass=this.node.addComponent("enemyManager"),this.enemyManagerClass.init(this),this.propManagerClass=this.propPNode.getComponent("propManager"),cc.director.on("DungeonedEvent",function(t){e.dealEvent(t)}),cc.director.on("battle",function(t){if(t.battleData.lose)return s.gameStatu=0,void(e.loadNode.active=!0);e.battleEnd(t.battleData)})},initGame:function(){s.startTime=Date.parse(new Date),s.layerConfig={},s.layerNpcBox={},l.getHeroData(),this.propManagerClass.init(this),this.UIManagerClass.init(this),this.layerManagerClass.initLayer(r.curLayer)},battleEnd:function(e){s.gameStatu=0;var t=n(Object.values(e)),o=t[0],a=t[1];if("521"==a.enemy.id){for(var c=0;c<s.curLayerLinkEnemy.length;c++)this.hideNode(s.curLayerLinkEnemy[c].pos),s.curLayerLinkEnemy[c].main&&l.delConfigItem(r.curLayer,s.curLayerLinkEnemy[c].pos,a.enemy.id);s.curLayerLinkEnemy=[]}else{var i="".concat(a.enemyPos.x,"-").concat(a.enemyPos.y),d=s.curLayerEnemyPosArr.indexOf(i);d&&s.curLayerEnemyPosArr.splice(d,1),s.curLayerEnemy[a.enemy.id]--,this.hideNode(a.enemyPos),l.delConfigItem(r.curLayer,a.enemyPos,a.enemy.id)}for(var p in this.enemyManagerClass.enemyFunc(a.enemy.id,a.enemyPos),o)r[p]=o[p];r.exp+=a.enemy.ex,r.gold+=a.enemy.gold,this.UIManagerClass.updateUI()},dealEvent:function(e){var t=this;switch(e.event){case"initGame":this.initGame();break;case"npc":this.npcManagerClass.initNpcDalog(e.box,e.pos,e.id);break;case"164":if(this.controlClass.layerNode.pauseSystemEvents(),l.playEffect("stairs"),20==r.curLayer)return console.log("over"),void l.loadNode("prefabs/bgDialog","bgDialog",function(e){e.parent=cc.director.getScene().children[0],e.active=!0,e.getComponent("dialog").init(t,[["\u5c31\u8fd9\u6837\u4f60\u7a81\u7834\u4e86\u6781\u9650\uff0c\u7528\u4f60\u7684\u667a\u6167\u653b\u7834\u4e8620\u5c42\u9b54\u5854\uff0c\u4f46\u8fd9\u4ec5\u4ec5\u662f\u4e2a\u5f00\u59cb\uff0c\u4e0a\u9762\u8fd8\u6709\u66f4\u90aa\u6076\u7684\u52bf\u529b\u7b49\u7740\u4f60\uff0c\u9b54\u738b\u5728\u8fdc\u5904\u7aa5\u89c6\u7740\u4f60\uff0c\u73b0\u5728\u4f60\u5df2\u7ecf\u65e0\u6cd5\u505c\u6b62\u81ea\u5df1\u7684\u811a\u6b65\uff0c\u524d\u5f80\u66f4\u9ad8\u7684\u697c\u5c42\u5427!","\u9b54\u58542021\u7b2c\u4e00\u7ae0\u7ed3\u675f,\u656c\u8bf7\u671f\u5f85\u540e\u7eed\u66f4\u65b0\u3002"],null,null])});7==r.curLayer&&this.controlClass.moveHero(cc.v2(r.pos.x,r.pos.y-1)),18==r.curLayer?r.curLayer=20:r.curLayer++,this.controlClass.removeScheule(),this.layerManagerClass.initLayer(r.curLayer);break;case"163":this.controlClass.layerNode.pauseSystemEvents(),l.playEffect("stairs"),8==r.curLayer&&this.controlClass.moveHero(cc.v2(r.pos.x,r.pos.y+1)),20==r.curLayer?r.curLayer=18:r.curLayer--,this.controlClass.removeScheule(),this.layerManagerClass.initLayer(r.curLayer);break;case"1000":l.playEffect("kaimeng"),this.UIManagerClass.updateUI(),this.playDoorAnim(e.pos,e.id);break;case"2000":this.UIManagerClass.updateUI(),this.hideNode(e.pos),l.delConfigItem(r.curLayer,e.pos,e.id);break;case"3000":this.propManagerClass.updateAssignProp(e.id),this.hideNode(e.pos),l.delConfigItem(r.curLayer,e.pos,e.id);break;case"updateLayer":this.controlClass.layerNode.pauseSystemEvents(),this.controlClass.moveHero(cc.v2(r.pos.x,r.pos.y)),this.controlClass.removeScheule(),this.layerManagerClass.initLayer(r.curLayer);break;case"updateUI":this.UIManagerClass.updateUI()}},playDoorAnim:function(e,t){var o=this,n=s.layerNodeMap["".concat(e.x,"-").concat(e.y)].position;l.loadNode("door/door".concat(t),"door".concat(t),function(e){e.active=!0,e.parent=o.itemP,e.position=n,e.getChildByName("door-0").getComponent(cc.Animation).playAdditive("door".concat(t)),setTimeout(function(){l.recycleNode(e),16==r.curLayer&&o.check16Secret()},200)});var a="".concat(e.x,"-").concat(e.y),c=s.curLayerDoorPosArr.indexOf(a);c&&s.curLayerDoorPosArr.splice(c,1),this.hideNode(e),l.delConfigItem(r.curLayer,e,t)},hideNode:function(e){l.recyclePoolNode(s.layerNodeMap["".concat(e.x,"-").concat(e.y)]),delete s.layerNodeMap["".concat(e.x,"-").concat(e.y)]},check16Secret:function(){if(l.isOpenLayer16Secret()){r.layer16Secret=!0;for(var e=cc.v2(11,13),t=0;t<s.layerConfig[r.curLayer].length;t++)e.x!=s.layerConfig[r.curLayer][t].x||e.y!=s.layerConfig[r.curLayer][t].y||(s.layerConfig[r.curLayer][t].type="item",this.layerManagerClass.initNodeOrEnemy(s.layerConfig[r.curLayer][t]))}},closeDialog:function(){s.gameStatu=0,this.loadNode.active=!0},fightWithEnemy:function(e){var t=n(e),o=t[0],a=t[1];if(d.EnemyAttribute[o].def>=r.atk)return l.pop(null,"\u65e0\u6cd5\u653b\u51fb"),void(s.gameStatu=0);this.UIManagerClass.showFightUI(d.EnemyAttribute[o],a,{hp:r.hp,atk:r.atk,def:r.def,atkSpeed:r.atkSpeed})},openLoadShader:function(){this.loadShade.active=!0},closeLoadShader:function(){this.loadShade.active=!1},loadMusic:function(){var e=cc.sys.localStorage.getItem("bgMusic".concat(p.userId)),t=cc.sys.localStorage.getItem("effectMusic".concat(p.userId));s.bgMusicSize=e||1,s.effectMusicSize=t||1}}),cc._RF.pop()},{"./config":"config","./gameData":"gameData","./heroData":"heroData","./tool":"tool","./userData":"userData"}],goldNpc:[function(e,t,o){"use strict";cc._RF.push(t,"4a51eDqrwdKbpJ+Z2UPyE2c","goldNpc");var n=e("heroData"),a=e("tool");cc.Class({extends:cc.Component,properties:{needGoldLab:cc.Label,promoteAtkBtn:cc.Node,promoteDefBtn:cc.Node,promoteHpBtn:cc.Node,closeBtn:cc.Node},onLoad:function(){var e=this;this.promoteAtkBtn.on("click",function(){n.gold>=n.goldNpc[0].gold?(n.atk+=2,a.playEffect("jinbishangdian"),e.changeGold()):a.pop(null,"\u91d1\u5e01\u4e0d\u8db3")},this),this.promoteDefBtn.on("click",function(){n.gold>=n.goldNpc[0].gold?(n.def+=3,a.playEffect("jinbishangdian"),e.changeGold()):a.pop(null,"\u91d1\u5e01\u4e0d\u8db3")},this),this.promoteHpBtn.on("click",function(){n.gold>=n.goldNpc[0].gold?(n.Hp+=300,a.playEffect("jinbishangdian"),e.changeGold()):a.pop(null,"\u91d1\u5e01\u4e0d\u8db3")},this),this.closeBtn.on("click",function(){a.recycleNode(e.node)},this)},changeGold:function(){n.gold-=n.goldNpc[0].gold,n.goldNpc[0].count++,n.goldNpc[0].gold=n.goldNpc[0].gold+2*n.goldNpc[0].count,this.needGoldLab.string=n.goldNpc[0].gold,cc.director.emit("DungeonedEvent",{event:"updateUI"})},onEnable:function(){this.needGoldLab.string=n.goldNpc[0].gold}}),cc._RF.pop()},{heroData:"heroData",tool:"tool"}],heroData:[function(e,t,o){"use strict";cc._RF.push(t,"6affcfXCfJFub4D2JOn8z+L","heroData");var n={pos:cc.v2(7,6),hp:1e3,atk:10,def:10,gold:0,atkSpeed:5,exp:0,yellowKey:0,buleKey:0,redKey:0,curLayer:1,level:1,heroDir:cc.v2(0,1),noteStairs:{},heroSword:0,heroShield:0,playTime:0,goldNpc:[{gold:20,count:0}],expNpc:[{exp:70,count:0}],keyNpc:{yellow:{gold:50,count:0},bule:{gold:100,count:0},red:{gold:200,count:0}},propArr:{121:0,142:0,151:0,153:0,171:0,122:0},meetProp:{}};t.exports=n,cc._RF.pop()},{}],hero:[function(e,t,o){"use strict";cc._RF.push(t,"ddb81snuA1O+IxRPNakPkFD","hero");var n=e("./heroData");cc.Class({extends:cc.Component,properties:{},onLoad:function(){},init:function(e){this.hero=this.node,this.heroAnim=this.node.getChildByName("hero-0").getComponent(cc.Animation)},startUp:function(){this.animState&&"heroUp"==this.animState.name&&this.animState.isPlaying||(this.animState=this.heroAnim.play("heroUp"))},startDown:function(){this.animState&&"heroDown"==this.animState.name&&this.animState.isPlaying||(this.animState=this.heroAnim.play("heroDown"))},startLeft:function(){this.animState&&"heroLeft"==this.animState.name&&this.animState.isPlaying||(this.animState=this.heroAnim.play("heroLeft"))},startRight:function(){this.animState&&"heroRight"==this.animState.name&&this.animState.isPlaying||(this.animState=this.heroAnim.play("heroRight"))},stopAllAnim:function(){var e=this;setTimeout(function(){e.heroAnim.stop()},100)},changeDir:function(e){n.heroDir=e,e.x>0?this.startRight():e.x<0?this.startLeft():e.y>0?this.startUp():e.y<0&&this.startDown()}}),cc._RF.pop()},{"./heroData":"heroData"}],hideNodeManager:[function(e,t,o){"use strict";cc._RF.push(t,"6d74ehqJ55J95NPTaa31xed","hideNodeManager"),cc.Class({extends:cc.Component,properties:{},init:function(e){this.mainClass=e}}),cc._RF.pop()},{}],item:[function(e,t,o){"use strict";cc._RF.push(t,"81c493hxb9AsIJ7dmgnB/KA","item");e("heroData");var n=e("objTriggerFunc");cc.Class({extends:cc.Component,properties:{},init:function(e){this.id=e,n[e]?this.triggerFunc=n[e]:this.triggerFunc=function(){}}}),cc._RF.pop()},{heroData:"heroData",objTriggerFunc:"objTriggerFunc"}],keyNpc:[function(e,t,o){"use strict";cc._RF.push(t,"5e03dk+3WpEcqM9+F6A+WSG","keyNpc");var n=e("heroData"),a=e("tool");cc.Class({extends:cc.Component,properties:{promoteAtkBtn:cc.Node,promoteDefBtn:cc.Node,promoteLevelBtn:cc.Node,closeBtn:cc.Node},onLoad:function(){var e=this;this.promoteAtkBtn.on("click",function(){n.gold>=n.keyNpc.yellow.gold?(a.playEffect("jinbishangdian"),n.yellowKey+=1,e.changeGold("yellow")):a.pop(null,"\u91d1\u5e01\u4e0d\u8db3")},this),this.promoteDefBtn.on("click",function(){n.gold>=n.keyNpc.bule.gold?(a.playEffect("jinbishangdian"),n.buleKey+=1,e.changeGold("bule")):a.pop(null,"\u91d1\u5e01\u4e0d\u8db3")},this),this.promoteLevelBtn.on("click",function(){n.gold>=n.keyNpc.red.gold?(a.playEffect("jinbishangdian"),n.redKey+=1,e.changeGold("red")):a.pop(null,"\u91d1\u5e01\u4e0d\u8db3")},this),this.closeBtn.on("click",function(){a.recycleNode(e.node)},this)},changeGold:function(e){n.keyNpc[e].count++,n.gold-=n.keyNpc[e].gold,cc.director.emit("DungeonedEvent",{event:"updateUI"})},onEnable:function(){}}),cc._RF.pop()},{heroData:"heroData",tool:"tool"}],layerManager:[function(e,t,o){"use strict";cc._RF.push(t,"92ac8NqO/lHyrWywgda3ExH","layerManager");var n=e("./heroData"),a=e("./gameData"),c=e("./tool");cc.Class({extends:cc.Component,properties:{},initLayer:function(e){var t=this;for(var o in this.mainClass.controlClass.unscheduleAllCallbacks(),this.mainClass.openLoadShader(),a.layerNodeMap)c.recyclePoolNode(a.layerNodeMap[o]);a.layerNodeMap={},a.curLayerEnemy={},a.curLayerEnemyPosArr=[],a.curLayerLinkEnemy=[],a.unMovePosArr=[],a.curLayerStairsPosArr=[],a.curLayerDoorPosArr=[],c.loadLayer(e,function(o){t.tiledMap.tmxAsset=o,t.initLayerConfig(e),t.initTiled(),setTimeout(function(){t.mainClass.closeLoadShader()},200),t.mainClass.UIManagerClass.updateLayer(),t.mainClass.controlClass.layerNode.resumeSystemEvents()})},init:function(e){this.mainClass=e,this.controlClass=e.controlClass,this.itemP=e.itemP,this.gameAtlas=e.gameAtlas,this.tiledMap=this.node.getComponent(cc.TiledMap)},initTiled:function(){this.wallLayer=this.tiledMap.getLayer("wall"),this.floorLayer=this.tiledMap.getLayer("floor"),this.layerSize=this.floorLayer.getLayerSize(),this.tiledSize=this.tiledMap.getTileSize(),this.wallArr=[];for(var e=0;e<this.layerSize.width;e++)for(var t=0;t<this.layerSize.height;t++){0!=this.wallLayer.getTiledTileAt(e,t,!0).gid&&this.wallArr.push(e+"-"+t)}this.controlClass.initHeroPos()},start:function(){},initLayerConfig:function(e){var t=this;c.getLayerConfig(e,function(o){a.layerConfig[e]=o,a.layerNodeMap={},o.map(function(e){t.initNodeOrEnemy(e)})})},triggerGrid:function(e,t){if(a.layerNodeMap["".concat(e,"-").concat(t)]){var o=a.layerNodeMap["".concat(e,"-").concat(t)].getComponent("item");if(o)return o.triggerFunc(cc.v2(e,t))}return!0},initNodeOrEnemy:function(e){var t=this;if("hideItem"!=e.type){if(201==e.id||202==e.id||250==e.id||169==e.id||203==e.id)return c.getLayerNpcArr(n.curLayer),c.loadPoolNode("npc/npc".concat(e.id),"npc"+e.id,function(o){o.active=!0;var n=o.getComponent("item"),c=t.floorLayer.getTiledTileAt(e.x,e.y,!0);o.position=cc.v2(c.node.position.x+=t.tiledSize.width/2,c.node.position.y+=t.tiledSize.height/2),o.parent=t.itemP,n.init(e.id),n.__isFirst=e.first||0,a.layerNodeMap["".concat(e.x,"-").concat(e.y)]=o}),void(250==e.id&&(e.x,e.y,a.unMovePosArr.push(e.x-1+"-"+e.y),a.unMovePosArr.push(e.x+1+"-"+e.y)));if("enemy"==e.type)return a.curLayerEnemyPosArr.push(e.x+"-"+e.y),a.curLayerEnemy[e.id]?a.curLayerEnemy[e.id]++:a.curLayerEnemy[e.id]=1,void c.loadPoolNode("enemyItem/enemy".concat(e.id),"enemy"+e.id,function(o){o.active=!0;var n=o.getComponent("enemy");n||(n=o.addComponent("enemy"));var c=t.floorLayer.getTiledTileAt(e.x,e.y,!0);if(o.position=cc.v2(c.node.position.x+=t.tiledSize.width/2,c.node.position.y+=t.tiledSize.height/2),o.parent=t.itemP,"521"==e.id){var i={pos:cc.v2(e.x,e.y),node:o,main:!0};a.curLayerLinkEnemy.push(i),t.buildBigEnemy(e.id,e.x,e.y)}a.layerNodeMap["".concat(e.x,"-").concat(e.y)]=o,n.init(e.id)});"164"!=e.id&&"163"!=e.id||(this.noteStairsPos(e),a.curLayerStairsPosArr.push(e.x+"-"+e.y)),c.loadPoolNode("prefabs/item","item",function(o){"157"!=e.id&&"158"!=e.id&&"159"!=e.id||a.curLayerDoorPosArr.push(e.x+"-"+e.y);var n=o.getComponent("item");o.getComponent(cc.Sprite).spriteFrame=t.gameAtlas.getSpriteFrame("item_".concat(e.id));var c=t.floorLayer.getTiledTileAt(e.x,e.y,!0);o.position=cc.v2(c.node.position.x+=t.tiledSize.width/2,c.node.position.y+=t.tiledSize.height/2),o.parent=t.itemP,n.init(e.id),a.layerNodeMap["".concat(e.x,"-").concat(e.y)]=o})}},buildBigNpc:function(e,t){for(var o=[[e-1,t],[e+1,t]],n=function(e){c.loadPoolNode("prefabs/item","item",function(t){var n=t.getComponent("item");t.getComponent(cc.Sprite).spriteFrame=null,n.init(1e3),a.layerNodeMap["".concat(o[e][0],"-").concat(o[e][1])]=t})},i=0;i<o.length;i++)n(i)},noteStairsPos:function(e){if(!n.noteStairs[n.curLayer])return n.noteStairs[n.curLayer]={},void(n.noteStairs[n.curLayer][e.id]=cc.v2(e.x,e.y));n.noteStairs[n.curLayer][e.id]||(n.noteStairs[n.curLayer][e.id]=cc.v2(e.x,e.y))},buildBigEnemy:function(e,t,o){for(var n=[[t-1,o-1],[t,o+1],[t+1,o+1],[t-1,o],[t+1,o],[t-1,o-t],[t,o-1],[t+1,o-1]],i=function(t){c.loadPoolNode("prefabs/bigEnemy","bigEnemy",function(o){var c=o.getComponent("enemy");a.layerNodeMap["".concat(n[t][0],"-").concat(n[t][1])]=o,c.init(e);var i={pos:cc.v2(n[t][0],n[t][1]),node:o};a.curLayerLinkEnemy.push(i)})},r=0;r<n.length;r++)i(r)},onDisable:function(){for(var e in a.layerNodeMap)c.recyclePoolNode(a.layerNodeMap[e]);console.log("gameData.layerNodeMap",a.layerNodeMap),a.layerNodeMap={},a.curLayerEnemy={},a.curLayerEnemyPosArr=[],a.curLayerStairsPosArr=[],a.curLayerDoorPosArr=[],a.curLayerLinkEnemy=[],a.unMovePosArr=[]}}),cc._RF.pop()},{"./gameData":"gameData","./heroData":"heroData","./tool":"tool"}],load:[function(e,t,o){"use strict";cc._RF.push(t,"29ea1/R8Y1P8KReEmaOMQhG","load");var n=e("../script/tool"),a=e("gameData");cc.Class({extends:cc.Component,properties:{loadProgress:cc.Node,newGame:cc.Node,shareBtn:cc.Node},onLoad:function(){this.addBtnListen(),this.shareBtn.on("click",function(){wx.getSetting({success:function(e){e.authSetting["scope.userInfo"]?this.getUserInfo():wx.authorize({scope:"scope.userInfo",success:function(){this.getUserInfo()}})}})},this)},getUserInfo:function(){wx.getUserInfo({success:function(e){var t=e.userInfo;t.nickName,t.avatarUrl,t.gender,t.province,t.city,t.country;console.log("userInfo",JSON.stringify(e)),wx.setUserCloudStorage("gametime",10)},fail:function(e){console.log("fail userInfo",JSON.stringify(e))}})},onEnable:function(){var e=this;a.isOverGame&&n.loadNode("prefabs/chooseProgress","chooseProgress",function(t){t.parent=e.node,a.isOverGame=!1,t.active=!0,t.getComponent("chooseProgress").loadGameInit(!1,e)})},addBtnListen:function(){var e=this;this.loadProgress.on("click",function(){n.loadNode("prefabs/chooseProgress","chooseProgress",function(t){t.parent=e.node,t.active=!0,t.getComponent("chooseProgress").loadGameInit(!1,e)})},this),this.newGame.on("click",function(){n.loadNode("prefabs/chooseProgress","chooseProgress",function(t){t.parent=e.node,t.active=!0,t.getComponent("chooseProgress").loadGameInit(!0,e)})},this)}}),cc._RF.pop()},{"../script/tool":"tool",gameData:"gameData"}],npcManager:[function(e,t,o){"use strict";cc._RF.push(t,"23f21e18+pNpapoPV4X7ydX","npcManager");var n=e("./tool"),a=e("./heroData"),c=e("./config"),i=e("./gameData");cc.Class({extends:cc.Component,properties:{},init:function(e){this.mainClass=e;var t=this;this.funcMap={"1-7-7":function(e){t.npc1_7_7(e)},"1-7-1":function(e){t.npc1_7_1(e)},"4-11-1":function(e){t.npc4_11_1(e)},"4-4-3":function(e){t.npc4_4_3(e)},"9-11-1":function(e){t.npc9_11_1(e)},"5-2-1":function(e){},"10-7-5":function(e){t.npc10_7_5(e)},"11-13-13":function(e){t.npc11_13_13(e)},"11-13-1":function(e){t.npc11_13_1(e)},"11-1-13":function(e){t.npc11_1_13(e)},"14-1-11":function(e){},"17-8-13":function(e){},"18-5-8":function(e){},"20-7-6":function(){t.npc20_7_6()}}},initNpcDalog:function(e,t,o){var c=this;if(e)n.loadNode("prefabs/dialog","dialog",function(n){n.parent=c.node,n.active=!0;var a=n.getComponent("dialog"),i=c.checkIsSpecialDalog(t);i&&(e=i),a.init(c,[e,t,o])});else{var i="".concat(a.curLayer,"-").concat(t.x,"-").concat(t.y);this.funcMap[i]&&this.funcMap[i](!0)}},closeDialog:function(e,t){console.log(e);var o="".concat(a.curLayer,"-").concat(e.x,"-").concat(e.y),c=n.changeNpcConfig(a.curLayer,e,t);this.funcMap[o]&&this.funcMap[o](c)},npc11_13_13:function(e){e&&(n.pop(null,"\u7ecf\u9a8c\u589e\u52a0200"),a.exp+=250,this.mainClass.UIManagerClass.updateUI())},npc11_1_13:function(e){e&&(n.pop(null,"\u91d1\u5e01\u589e\u52a0200"),a.gold+=1e3,this.mainClass.UIManagerClass.updateUI())},npc11_13_1:function(e){if(e){var t=cc.v2(13,1);n.delConfigShowItem(a.curLayer,t),this.mainClass.hideNode(t)}},npc20_7_6:function(){for(var e=cc.v2(7,7),t=0;t<i.layerConfig[a.curLayer].length;t++)e.x!=i.layerConfig[a.curLayer][t].x||e.y!=i.layerConfig[a.curLayer][t].y||(i.layerConfig[a.curLayer][t].type="item",this.mainClass.layerManagerClass.initNodeOrEnemy(i.layerConfig[a.curLayer][t]))},npc10_7_5:function(){for(var e=cc.v2(7,6),t=0;t<i.layerConfig[a.curLayer].length;t++)e.x!=i.layerConfig[a.curLayer][t].x||e.y!=i.layerConfig[a.curLayer][t].y||(i.layerConfig[a.curLayer][t].type="item",this.mainClass.layerManagerClass.initNodeOrEnemy(i.layerConfig[a.curLayer][t]))},npc9_11_1:function(e){var t=this;n.loadNode("prefabs/keyNpc","keyNpc",function(e){e.parent=t.node,e.active=!0})},npc4_4_3:function(e){var t=this;n.loadNode("prefabs/goldNpc","goldNpc",function(e){e.parent=t.node,e.active=!0})},npc4_11_1:function(e){var t=this;n.loadNode("prefabs/expNpc","expNpc",function(e){e.parent=t.node,e.active=!0})},npc1_7_7:function(e){if(e){var t=cc.v2(7,5);cc.director.emit("DungeonedEvent",{event:"1000",pos:t,id:"156"})}},npc1_7_1:function(e){if(e){for(var t=0;t<c.layer1DelItemArr.length;t++)n.delConfigShowItem(a.curLayer,c.layer1DelItemArr[t]),this.mainClass.hideNode(c.layer1DelItemArr[t]);for(var o=0;o<c.layer1HideItemArr.length;o++)for(var r=0;r<i.layerConfig[a.curLayer].length;r++)c.layer1HideItemArr[o].x!=i.layerConfig[a.curLayer][r].x||c.layer1HideItemArr[o].y!=i.layerConfig[a.curLayer][r].y||(i.layerConfig[a.curLayer][r].type="item",this.mainClass.layerManagerClass.initNodeOrEnemy(i.layerConfig[a.curLayer][r]))}},checkIsSpecialDalog:function(e){var t=null;switch("".concat(a.curLayer,"-").concat(e.x,"-").concat(e.y)){case"5-2-1":a.propArr[142]>=1&&(t=i.layerNpcBox[a.curLayer]["".concat(e.x,"-").concat(e.y)][3]),a.propArr[151]>=1&&(t=i.layerNpcBox[a.curLayer]["".concat(e.x,"-").concat(e.y)][2]);break;case"14-1-11":a.propArr[122]>=1&&(t=i.layerNpcBox[a.curLayer]["".concat(e.x,"-").concat(e.y)][2]);break;case"18-5-8":"138"==a.heroShield&&(t=i.layerNpcBox[a.curLayer]["".concat(e.x,"-").concat(e.y)][2]);break;case"17-8-13":a.layer16Secret&&(t=i.layerNpcBox[a.curLayer]["".concat(e.x,"-").concat(e.y)][2])}return t}}),cc._RF.pop()},{"./config":"config","./gameData":"gameData","./heroData":"heroData","./tool":"tool"}],objTriggerFunc:[function(e,t,o){"use strict";cc._RF.push(t,"8c429xUEfxPlas0E2HMyFIh","objTriggerFunc");var n=e("./heroData"),a=e("./gameData"),c=e("./tool"),i=e("./config"),r={124:function(e){return c.playEffect("huodewup"),n.atk+=2,!n.meetProp[124]&&(n.meetProp[124]=!0),cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"124"}),!0},125:function(e){return!n.meetProp[125]&&(n.meetProp[125]=!0),c.playEffect("huodewup"),n.def+=2,cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"125"}),!0},126:function(e){return!n.meetProp[126]&&(n.meetProp[126]=!0),c.playEffect("huodewup"),n.atkSpeed+=2,cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"126"}),!0},134:function(e){return!n.meetProp[134]&&(n.meetProp[134]=!0),c.playEffect("xueping"),n.hp+=50,cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"134"}),!0},135:function(e){return!n.meetProp[135]&&(n.meetProp[135]=!0),c.playEffect("xueping"),n.hp+=150,cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"135"}),!0},131:function(e){return!n.meetProp[131]&&(n.meetProp[131]=!0),c.playEffect("huodewup"),n.def+=3,n.atk+=3,n.hp+=200,n.level+=1,c.playEffect("shenji"),cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"131"}),!0},145:function(e){return!n.meetProp[145]&&(n.meetProp[145]=!0),c.playEffect("huodewup"),n.buleKey+=1,cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"145"}),console.log(e),!0},144:function(e){return!n.meetProp[144]&&(n.meetProp[144]=!0),c.playEffect("huodewup"),n.yellowKey+=1,cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"144"}),!0},146:function(e){return!n.meetProp[146]&&(n.meetProp[146]=!0),c.playEffect("huodewup"),n.redKey+=1,cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"146"}),!0},158:function(e){return n.buleKey>=1?(n.buleKey-=1,cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"158"}),!0):(c.pop(null,"\u84dd\u94a5\u5319\u4e0d\u8db3"),!1)},157:function(e){return n.yellowKey>=1?(n.yellowKey-=1,cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"157"}),!0):(c.pop(null,"\u9ec4\u94a5\u5319\u4e0d\u8db3"),!1)},159:function(e){return n.redKey>=1?(n.redKey-=1,cc.director.emit("DungeonedEvent",{event:"1000",pos:e,id:"159"}),!0):(c.pop(null,"\u7ea2\u94a5\u5319\u4e0d\u8db3"),!1)},164:function(){return cc.director.emit("DungeonedEvent",{event:"164"}),!0},163:function(){return cc.director.emit("DungeonedEvent",{event:"163"}),!0},136:function(e){return c.playEffect("xueping"),n.exp+=5,cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"136"}),!0},156:function(){return!1},127:function(e){return!n.meetProp[127]&&(n.meetProp[127]=!0),c.pop(null,"\u83b7\u5f97".concat(i.itemInfo[127].name)),c.playEffect("huodewup"),n.atk+=20,n.heroSword="127",cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"127"}),!0},137:function(e){return!n.meetProp[137]&&(n.meetProp[137]=!0),c.pop(null,"\u83b7\u5f97".concat(i.itemInfo[137].name)),c.playEffect("huodewup"),n.def+=20,n.heroShield="137",cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"137"}),!0},140:function(e){return!n.meetProp[140]&&(n.meetProp[140]=!0),c.pop(null,"\u83b7\u5f97".concat(i.itemInfo[140].name)),c.playEffect("huodewup"),n.def+=100,n.heroShield="140",cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"140"}),!0},138:function(e){return!n.meetProp[138]&&(n.meetProp[138]=!0),c.pop(null,"\u83b7\u5f97".concat(i.itemInfo[138].name)),c.playEffect("huodewup"),n.def+=40,n.heroShield="138",cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"138"}),!0},128:function(e){return!n.meetProp[128]&&(n.meetProp[128]=!0),c.pop(null,"\u83b7\u5f97".concat(i.itemInfo[128].name)),c.playEffect("huodewup"),n.atk+=40,n.heroSword="128",cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"128"}),!0},161:function(){return!1},169:function(e){var t=null;return a.layerNpcBox[n.curLayer]&&a.layerNpcBox[n.curLayer]["".concat(e.x,"-").concat(e.y)]&&(t=a.layerNpcBox[n.curLayer]["".concat(e.x,"-").concat(e.y)][this.__isFirst]),1==this.__isFirst&&(cc.director.emit("DungeonedEvent",{event:"npc",box:t,pos:e,id:"169"}),this.__isFirst=0),!1},201:function(e){var t=null;return a.layerNpcBox[n.curLayer]&&a.layerNpcBox[n.curLayer]["".concat(e.x,"-").concat(e.y)]&&(t=a.layerNpcBox[n.curLayer]["".concat(e.x,"-").concat(e.y)][this.__isFirst]),cc.director.emit("DungeonedEvent",{event:"npc",box:t,pos:e,id:"201"}),this.__isFirst=0,!1},202:function(e){var t=null;return a.layerNpcBox[n.curLayer]&&a.layerNpcBox[n.curLayer]["".concat(e.x,"-").concat(e.y)]&&(t=a.layerNpcBox[n.curLayer]["".concat(e.x,"-").concat(e.y)][this.__isFirst]),cc.director.emit("DungeonedEvent",{event:"npc",box:t,pos:e,id:"202"}),this.__isFirst=0,!1},203:function(e){var t=null;return a.layerNpcBox[n.curLayer]&&a.layerNpcBox[n.curLayer]["".concat(e.x,"-").concat(e.y)]&&(t=a.layerNpcBox[n.curLayer]["".concat(e.x,"-").concat(e.y)][this.__isFirst]),cc.director.emit("DungeonedEvent",{event:"npc",box:t,pos:e,id:"203"}),this.__isFirst=0,!1},250:function(e){return cc.director.emit("DungeonedEvent",{event:"npc",box:a.layerNpcBox[n.curLayer],pos:e,id:"250"}),this.__isFirst=0,!1},142:function(e){return!n.meetProp[142]&&(n.meetProp[142]=!0),c.pop(null,"\u83b7\u5f97".concat(i.itemInfo[142].name)),c.playEffect("huodewup"),n.propArr[142]+=1,cc.director.emit("DungeonedEvent",{event:"3000",pos:e,id:"142"}),!0},151:function(e){return!n.meetProp[151]&&(n.meetProp[151]=!0),c.pop(null,"\u83b7\u5f97".concat(i.itemInfo[151].name)),c.playEffect("huodewup"),n.propArr[151]+=1,cc.director.emit("DungeonedEvent",{event:"3000",pos:e,id:"151"}),!0},153:function(e){return!n.meetProp[153]&&(n.meetProp[153]=!0),c.pop(null,"\u83b7\u5f97".concat(i.itemInfo[153].name)),c.playEffect("huodewup"),n.propArr[153]+=1,cc.director.emit("DungeonedEvent",{event:"3000",pos:e,id:"153"}),!0},122:function(e){return!n.meetProp[122]&&(n.meetProp[122]=!0),c.pop(null,"\u83b7\u5f97".concat(i.itemInfo[122].name)),c.playEffect("huodewup"),n.propArr[122]+=1,cc.director.emit("DungeonedEvent",{event:"3000",pos:e,id:"122"}),!0},121:function(e){return!n.meetProp[121]&&(n.meetProp[121]=!0),c.pop(null,"\u83b7\u5f97".concat(i.itemInfo[121].name)),c.playEffect("huodewup"),n.propArr[121]+=1,cc.director.emit("DungeonedEvent",{event:"3000",pos:e,id:"121"}),!0},171:function(e){return c.playEffect("huodewup"),c.pop(null,"\u83b7\u5f97".concat(i.itemInfo[140].name)),!n.meetProp[140]&&(n.meetProp[140]=!0),n.propArr[171]+=1,cc.director.emit("DungeonedEvent",{event:"3000",pos:e,id:"171"}),!0},143:function(e){return!n.meetProp[143]&&(n.meetProp[143]=!0),c.playEffect("mofashuijp"),n.hp=n.hp+n.atk+n.def,cc.director.emit("DungeonedEvent",{event:"2000",pos:e,id:"143"}),!0}};t.exports=r,cc._RF.pop()},{"./config":"config","./gameData":"gameData","./heroData":"heroData","./tool":"tool"}],photo:[function(e,t,o){"use strict";cc._RF.push(t,"63552u183hMJritO/TieN/e","photo"),cc.Class({extends:cc.Component,properties:{camera:cc.Camera},onLoad:function(){var e=this,t=new cc.RenderTexture;t.initWithSize(cc.visibleRect.width,cc.visibleRect.height,cc.gfx.RB_FMT_S8),this.camera.targetTexture=t,this.texture=t,this.node.zIndex=1e4,this.node.on("click",function(){console.log("\u622a\u5c4f"),e.createCanvas();e.createImg()})},start:function(){},createCanvas:function(){var e=this.texture.width,t=this.texture.height;this._canvas?this.clearCanvas():(this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=t);var o=this._canvas.getContext("2d");this.camera.render();for(var n=this.texture.readPixels(),a=4*e,c=0;c<t;c++){for(var i=t-1-c,r=o.createImageData(e,1),s=i*e*4,l=0;l<a;l++)r.data[l]=n[s+l];o.putImageData(r,0,c)}return this._canvas},createImg:function(){var e=this._canvas.toDataURL("image/png"),t=document.createElement("img");return t.src=e,t}}),cc._RF.pop()},{}],pop:[function(e,t,o){"use strict";cc._RF.push(t,"7880bc2UilFfpPcrmsCzzMs","pop");var n=e("tool");cc.Class({extends:cc.Component,properties:{tipsLable:cc.Label,tipsInfo:{default:{},visiable:!1,notify:function(){this.onTipsInfo(this.tipsInfo)}}},onLoad:function(){this.isPop=!1},onTipsInfo:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{string:"",timeout:3,cb:null};this.isPop||(this.isPop=!0,t.string?(this.node.active=!0,this.tipsLable.string=t.string,this.node.scaleY=0,this.node.opacity=0,this.node.runAction(cc.sequence(cc.spawn(cc.fadeTo(.2,255),cc.scaleTo(.2,1,1)),cc.delayTime(2),cc.spawn(cc.fadeTo(.2,0),cc.scaleTo(.2,1,1)),cc.callFunc(function(){n.recycleNode(e.node),"function"==typeof t.cb&&t.cb(),e.node.active=!1,e.isPop=!1})))):(console.error("pop\u65e0\u5185\u5bb9"),this.node.active=!1,"function"==typeof t.cb&&t.cb()))}}),cc._RF.pop()},{tool:"tool"}],propInfo:[function(e,t,o){"use strict";cc._RF.push(t,"03a0cKsOV1LVY1oIzS0Dx3b","propInfo");var n=e("config"),a=e("tool"),c=e("heroData");cc.Class({extends:cc.Component,properties:{itemPrefab:cc.Prefab,itemP:cc.Node,closeBtn:cc.Node},onLoad:function(){var e=this;this.closeBtn.on("click",function(){e.node.active=!1,a.recycleNode(e.node)},this)},onEnable:function(){if(this.propKeyArr)for(var e=0;e<this.itemP.children.length;e++)c.meetProp[this.propKeyArr[e]]?this.itemP.children[e].getComponent("propItem").init(this.propValueArr[e].name,this.propValueArr[e].info,this.propKeyArr[e]):this.itemP.children[e].getComponent("propItem").init();else{this.propKeyArr=Object.keys(n.itemInfo),this.propValueArr=[];for(var t=0;t<this.propKeyArr.length;t++){this.propValueArr.push(n.itemInfo[this.propKeyArr[t]]);var o=item=cc.instantiate(this.itemPrefab);o.parent=this.itemP,c.meetProp[this.propKeyArr[t]]?o.getComponent("propItem").init(this.propValueArr[t].name,this.propValueArr[t].info,this.propKeyArr[t]):o.getComponent("propItem").init()}}}}),cc._RF.pop()},{config:"config",heroData:"heroData",tool:"tool"}],propItem:[function(e,t,o){"use strict";cc._RF.push(t,"8f536AThVdK47YRUc274odk","propItem");var n=e("gameData");cc.Class({extends:cc.Component,properties:{nameLab:cc.Label,icon:cc.Sprite,infoLab:cc.Label,noIcon:cc.Node},init:function(e,t,o){o?(this.nameLab.string=e,this.infoLab.string=t,this.icon.node.active=!0,this.noIcon.active=!1,this.icon.spriteFrame=n.gameAtlas.getSpriteFrame("item_".concat(o))):(this.nameLab.string="???",this.infoLab.string="???",this.icon.node.active=!1,this.noIcon.active=!0)}}),cc._RF.pop()},{gameData:"gameData"}],propManager:[function(e,t,o){"use strict";cc._RF.push(t,"7d1d7yi6RdA+bXscyfX1V/x","propManager");var n=e("./heroData"),a=(e("./gameData"),e("./tool"));cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.initPropFListen()},init:function(e){this.mainClass=e,this.propNodeArr=this.node.children;var t=this;this.funcMap={"1-7-1":function(e){t.pick1_7_1(e)},"9-1-1":function(e){t.pick9_1_1(e)},"8-4-7":function(e){t.pick8_4_7(e)},"13-6-13":function(e){t.pick13_6_13(e)}},this.updatePropUI()},updatePropUI:function(){for(var e in n.propArr){var t=0==n.propArr[e]?"":n.propArr[e];t?(this.node.getChildByName("propItem".concat(e)).active=!0,this.node.getChildByName("propItem".concat(e)).getChildByName("label")&&(this.node.getChildByName("propItem".concat(e)).getChildByName("label").getComponent(cc.Label).string=t)):this.node.getChildByName("propItem".concat(e)).active=!1}},updateAssignProp:function(e){var t=0==n.propArr[e]?"":n.propArr[e];if(t)return this.node.getChildByName("propItem".concat(e)).active=!0,void(this.node.getChildByName("propItem".concat(e)).getChildByName("label")&&(this.node.getChildByName("propItem".concat(e)).getChildByName("label").getComponent(cc.Label).string=t));this.node.getChildByName("propItem".concat(e)).active=!1},initPropFListen:function(){var e=this;this.node.getChildByName("propItem121").on("click",function(){a.loadNode("prefabs/flyProp","flyProp",function(t){t.active=!0,t.parent=e.mainClass.node})},this),this.node.getChildByName("propItem142").on("click",function(){e.usePick()},this),this.node.getChildByName("propItem153").on("click",function(){e.usePowerKey()},this),this.node.getChildByName("propItem122").on("click",function(){e.useFly()},this),this.node.getChildByName("propItem171").on("click",function(){a.loadNode("prefabs/enemyInfo","enemyInfo",function(t){t.active=!0,t.parent=e.mainClass.node})},this)},useFly:function(){if(!a.checkNextStairs(n.noteStairs[n.curLayer][163])&&!a.checkNextStairs(n.noteStairs[n.curLayer][164]))return a.pop(null,"\u4e0d\u5728\u697c\u68af\u65c1\u8fb9"),void a.playEffect("error");var e=n.curLayer+1;n.noteStairs[e]||19==e?(n.propArr[122]-=1,this.updateAssignProp("122"),n.curLayer=e,cc.director.emit("DungeonedEvent",{event:"updateLayer"})):a.pop(null,"\u4f7f\u7528\u4e86\u7279\u6b8a\u98de\u884c\u5668\u4f46\u4ec0\u4e48\u4e5f\u6ca1\u53d1\u751f")},usePowerKey:function(){if(11==n.curLayer)for(var e=[cc.v2(5,10),cc.v2(9,10),cc.v2(5,3),cc.v2(9,3)],t=0;t<e.length;t++)a.delConfigShowItem(n.curLayer,e[t]),this.mainClass.hideNode(e[t]);else a.pop(null,"\u4f7f\u7528\u4e86\u4e07\u80fd\u94a5\u5319\u4ec0\u4e48\u90fd\u6ca1\u53d1\u751f");n.propArr[153]-=1,this.updateAssignProp("153")},usePick:function(){var e,t=n.heroDir;t.x>0?e=cc.v2(n.pos.x+1,n.pos.y):t.x<0?e=cc.v2(n.pos.x-1,n.pos.y):t.y>0?e=cc.v2(n.pos.x,n.pos.y-1):t.y<0&&(e=cc.v2(n.pos.x,n.pos.y+1)),n.propArr[142]-=1,this.funcMap["".concat(n.curLayer,"-").concat(e.x,"-").concat(e.y)]?(a.pop(null,"\u4f7f\u7528\u5341\u5b57\u9550\u53d1\u73b0\u4e86\u9690\u85cf\u7269\u54c1\uff01"),this.funcMap["".concat(n.curLayer,"-").concat(e.x,"-").concat(e.y)](e)):a.pop(null,"\u4f7f\u7528\u4e86\u5341\u5b57\u9550\u4ec0\u4e48\u90fd\u6ca1\u53d1\u751f"),this.updateAssignProp("142")},pick1_7_1:function(e){this.mainClass.hideNode(e),a.delConfigItem(n.curLayer,e,"161");var t=a.changeHideConfig(n.curLayer,e,202);this.mainClass.layerManagerClass.initNodeOrEnemy(t)},pick9_1_1:function(e){this.mainClass.hideNode(e),a.delConfigItem(n.curLayer,e,"161");var t=a.changeHideConfig(n.curLayer,e,151);this.mainClass.layerManagerClass.initNodeOrEnemy(t)},pick8_4_7:function(e){this.mainClass.hideNode(e),a.delConfigItem(n.curLayer,e,"161");var t=a.changeHideConfig(n.curLayer,e,122);this.mainClass.layerManagerClass.initNodeOrEnemy(t)},pick13_6_13:function(e){this.mainClass.hideNode(e),a.delConfigItem(n.curLayer,e,"161");var t=a.changeHideConfig(n.curLayer,e,138);this.mainClass.layerManagerClass.initNodeOrEnemy(t)}}),cc._RF.pop()},{"./gameData":"gameData","./heroData":"heroData","./tool":"tool"}],tool:[function(e,t,o){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function c(e,t,o){return t&&a(e.prototype,t),o&&a(e,o),e}cc._RF.push(t,"691dfJj4ApBe6rxeZDeQqI7","tool");var i=e("./gameData"),r=e("./heroData"),s=e("./userData"),l=e("./config"),d=function(){function e(){n(this,e)}return c(e,null,[{key:"loadLayer",value:function(e,t){if(i.layerPool[e])return t(i.layerPool[e]);cc.loader.loadRes("layer/layer".concat(e),function(o,n){i.layerPool[e]=n,t(n)})}},{key:"aiMove",value:function(e,t,o,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[];i.includes(t.x+"-"+t.y)&&(i=[]);var r=0,s=[],l=[],d=!0,p=function(o,n,a){this.parent=a,this.x=o,this.y=n,this.g=a?a.g+1:Math.abs(e.x-this.x)+Math.abs(e.y-this.y),this.h=Math.abs(t.x-this.x)+Math.abs(t.y-this.y),this.f=this.g+this.h};s=[].concat(o,n,a,c,i);for(var u=new p(e.x,e.y,null);d;){++r>1e3&&(d=!1);var h=void 0;if(u.x>0&&(h=new p(u.x-1,u.y,u),s.indexOf(h.x+"-"+h.y)<0&&l.push(h)),u.x<19&&(h=new p(u.x+1,u.y,u),s.indexOf(h.x+"-"+h.y)<0&&l.push(h)),u.y>0&&(h=new p(u.x,u.y-1,u),s.indexOf(h.x+"-"+h.y)<0&&l.push(h)),u.y<19&&(h=new p(u.x,u.y+1,u),s.indexOf(h.x+"-"+h.y)<0&&l.push(h)),l.length<=0)d=!1;else{for(var y=l[0],f=l[0].f,m=0;m<l.length;m++)l[m].f<f&&(y=l[m],f=l[m]);for(var g=0;g<l.length;g++)l[g].x==y.x&&l[g].y==y.y&&l.splice(g,1);s.push(u.x+"-"+u.y),(u=y).x==t.x&&u.y==t.y&&(d=!1)}}var v=[];if(u.x!=t.x||u.y!=t.y)return v;for(;u;)v.push(u),u=u.parent;return v}},{key:"getLayerConfig",value:function(e,t){if(i.layerConfig[e])return t(i.layerConfig[e]);var o=cc.sys.localStorage.getItem("layerConfig".concat(e,"-").concat(i.progressIndex,"-").concat(s.userId));if(o)return t(JSON.parse(o));cc.loader.loadRes("config/layer".concat(e),function(e,o){t(JSON.parse(JSON.stringify(o.json)))})}},{key:"getHeroData",value:function(){var e,t=cc.sys.localStorage.getItem("hero".concat(i.progressIndex,"-").concat(s.userId));for(var o in e=t?JSON.parse(t):{pos:cc.v2(7,6),hp:1e3,atk:100,def:10,gold:0,atkSpeed:5,exp:0,yellowKey:0,buleKey:0,redKey:0,curLayer:1,goldNpc:[{gold:20,count:0}]})r[o]=e[o]}},{key:"saveProgress",value:function(t,o,n,a){for(var c in t!=o&&e.deleteProgress(o),r.noteStairs)if(n[c])cc.sys.localStorage.setItem("layerConfig".concat(c,"-").concat(o,"-").concat(s.userId),JSON.stringify(n[c]));else if(t!=o){var i=cc.sys.localStorage.getItem("layerConfig".concat(c,"-").concat(t,"-").concat(s.userId));cc.sys.localStorage.setItem("layerConfig".concat(c,"-").concat(o,"-").concat(s.userId),i)}cc.sys.localStorage.setItem("hero".concat(o,"-").concat(s.userId),JSON.stringify(a))}},{key:"deleteProgress",value:function(e){for(var t=0;t<61;t++)cc.sys.localStorage.removeItem("layerConfig".concat(t,"-").concat(e,"-").concat(s.userId));cc.sys.localStorage.removeItem("hero".concat(e,"-").concat(s.userId))}},{key:"getLayerNpcArr",value:function(e){i.layerNpcBox[e]||cc.loader.loadRes("config/layer".concat(e,"Dialogue"),function(t,o){i.layerNpcBox[e]=o?o.json:1})}},{key:"loadNode",value:function(e,t,o){if(i.nodeMap[t]){var n=i.nodeMap[t];return o(n),void(i.nodeMap[t]=null)}cc.loader.loadRes(e,function(e,t){var n=cc.instantiate(t);o(n)})}},{key:"loadLocalTitle",value:function(){var e=cc.sys.localStorage.getItem("localTitle".concat(s.userId)),t=[];return e&&(t=JSON.parse(e)),t}},{key:"saveLocalTitle",value:function(e){cc.sys.localStorage.setItem("localTitle".concat(s.userId),JSON.stringify(e))}},{key:"recycleNode",value:function(e){e.active=!1,i.nodeMap[e.name]=e,e.removeFromParent()}},{key:"changeNpcConfig",value:function(e,t,o){for(var n,a=0;a<i.layerConfig[e].length;a++)if(i.layerConfig[e][a].x==t.x&&i.layerConfig[e][a].y==t.y&&i.layerConfig[e][a].id==o){n=i.layerConfig[e][a].first,i.layerConfig[e][a].first=0;break}return n}},{key:"changeHideConfig",value:function(e,t,o){for(var n,a=0;a<i.layerConfig[e].length;a++)if(i.layerConfig[e][a].x==t.x&&i.layerConfig[e][a].y==t.y&&i.layerConfig[e][a].id==o){i.layerConfig[e][a].type="item",n=i.layerConfig[e][a];break}return n}},{key:"delConfigItem",value:function(e,t,o){for(var n=0;n<i.layerConfig[e].length;n++)if("hideItem"!=i.layerConfig[e][n]&&i.layerConfig[e][n].x==t.x&&i.layerConfig[e][n].y==t.y&&i.layerConfig[e][n].id==o){i.layerConfig[e].splice(n,1);break}}},{key:"checkPosIsHasEnemy",value:function(e,t,o){for(var n=!1,a=0;a<i.layerConfig[e].length;a++)if(i.layerConfig[e][a].x==t.x&&i.layerConfig[e][a].y==t.y&&i.layerConfig[e][a].id==o){n=!0;break}return n}},{key:"delConfigShowItem",value:function(e,t){for(var o=0;o<i.layerConfig[e].length;o++)if(i.layerConfig[e][o].x==t.x&&i.layerConfig[e][o].y==t.y&&"hideItem"!=i.layerConfig[e][o].type){i.layerConfig[e].splice(o,1);break}}},{key:"loadPoolNode",value:function(e,t,o){if(i.nodePoolMap[t]){var n=i.nodePoolMap[t],a=null;return a=n.size()>0?n.get():cc.instantiate(i.nodeMap[t]),o(a)}cc.loader.loadRes(e,function(e,n){i.nodePoolMap[t]=new cc.NodePool,i.nodeMap[t]=n;var a=cc.instantiate(n);o(a)})}},{key:"recyclePoolNode",value:function(e){i.nodePoolMap[e.name].put(e)}},{key:"isOpenLayer16Secret",value:function(){for(var e=0;e<l.layer16CloseDoorPos.length;e++){var t="".concat(l.layer16CloseDoorPos[e].x,"-").concat(l.layer16CloseDoorPos[e].y);if(!i.layerNodeMap[t])return!1}for(var o=0;o<l.layer16OpenDoorPos.length;o++){var n="".concat(l.layer16OpenDoorPos[o].x,"-").concat(l.layer16OpenDoorPos[o].y);if(i.layerNodeMap[n])return!1}return!0}},{key:"checkNextStairs",value:function(e){if(!e)return!1;for(var t=[cc.v2(e.x+1,e.y),cc.v2(e.x-1,e.y),cc.v2(e.x,e.y+1),cc.v2(e.x,e.y-1),cc.v2(e.x,e.y)],o=0;o<t.length;o++)if(r.pos.x==t[o].x&&r.pos.y==t[o].y)return!0;return!1}},{key:"playEffect",value:function(e){0!=i.effectMusicSize&&(cc.audioEngine.stopAllEffects(),i.musicMap[e]?cc.audioEngine.playEffect(i.musicMap[e],!1):cc.loader.loadRes("audio/".concat(e),cc.AudioClip,function(e,t){cc.audioEngine.playEffect(t,!1)}))}},{key:"playBg",value:function(){0!=i.bgMusicSize&&(cc.audioEngine.stopMusic(),i.musicMap[name]?cc.audioEngine.playMusic(i.musicMap[name],!1):cc.loader.loadRes("audio/".concat(name),cc.AudioClip,function(e,t){cc.audioEngine.playMusic(t,!1)}))}},{key:"getPlayTime",value:function(e){e/=1e3;var t=parseInt(e/60/60),o=parseInt(e/60%60),n=parseInt(e%60);return"".concat(t,"h").concat(o,"m").concat(n,"s")}},{key:"pop",value:function(t,o){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;"function"==typeof n&&(a=n,n=3);var c=cc.director.getScene();c&&c.isValid&&(t&&t.isValid||(t=c.children[0]),e.loadNode("prefabs/popBack","popBack",function(e){e.parent=null,e.parent=t;var c=e.getComponent("pop");Object.assign(c,{tipsInfo:{string:o,timeout:n,cb:a}});for(var i=0,r=t.children,s=r.length-1;s>=0;s--){var l=r[s];l.isValid&&l.active&&"pop"==l.name&&(l.y=50*i++)}}))}}]),e}();t.exports=d,cc._RF.pop()},{"./config":"config","./gameData":"gameData","./heroData":"heroData","./userData":"userData"}],userData:[function(e,t,o){"use strict";cc._RF.push(t,"fb90bs7TdNB5LWNPHQv5bj5","userData");t.exports={userId:"10001"},cc._RF.pop()},{}]},{},["load","photo","chooseProgress","dialog","enemyInfo","enemyInfoItem","expNpc","fight","flyProp","goldNpc","item","keyNpc","pop","propInfo","propItem","UIManager","config","control","enemy","enemyManager","gameData","gameManager","hero","heroData","hideNodeManager","layerManager","npcManager","objTriggerFunc","propManager","tool","userData"]);